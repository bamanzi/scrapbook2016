<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>LFCS 系列第七讲：通过 SysVinit、Systemd 和 Upstart 管理系统自启动进程和服务-技术 ◆ 学习|Linux.中国-开源社区</title>
 
<meta name="keywords" content="LFCS 系列第七讲：通过 SysVinit、Systemd 和 Upstart 管理系统自启动进程和服务">
<meta name="description" content="在这篇文章中，我们会介绍如何管理 Linux 系统自启动进程和服务 ">
<meta name="copyright" content="2005-2015 Linux.cn">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta name="applicable-device" content="pc,mobile">
<meta name="referrer" content="always">
<base href="">










<link rel="alternate" type="application/rss+xml" title="Linux.中国 - 开源社区 RSS" href="https://linux.cn/rss.xml">
<link rel="shortcut icon" href="favicon.ico" sizes="32x32">
<link rel="canonical" href="https://linux.cn/article-7365-2.html">

<link rel="stylesheet" type="text/css" href="index.css" media="all">
</head>
<body id="nv_portal" class="pg_view"><div id="wp" class="wp"><div id="ct" class="ct2 wp cl"><div class="mn"><div class="vw"><div class="d"><div id="article_content"><!--DOCUMENT_FRAGMENT--><a id="3_16637" class="target-fix"></a><h3 id="toc_9">Upstart</h3>
<p>基于事件的 Upstart 是 /sbin/init 守护进程的替代品，它仅为在需要那些服务的时候启动服务而生，（或者当它们在运行时管理它们），以及处理发生的实践，因此 Upstart 优于基于依赖的 sysvinit 系统。</p>
<p>一开始它是为 Ubuntu 发行版开发的，但在红帽企业版 Linux 6.0 中得到使用。尽管希望它能在所有 Linux 发行版中替代 sysvinit，但它已经被 systemd 超越。2014 年 2 月 14 日，Mark Shuttleworth（Canonical Ltd. 创建者）发布声明之后的 Ubuntu 发行版采用 systemd 作为默认初始化守护进程。</p>
<p>由于 Sysv 启动脚本已经流行很长时间了，很多软件包中都包括了 Sysv 启动脚本。为了兼容这些软件， Upstart 提供了兼容模式：它可以运行保存在常用位置（/etc/rc.d/rc?.d, /etc/init.d/rc?.d, /etc/rc?.d或其它类似的位置）的Sysv 启动脚本。因此，如果我们安装了一个还没有 Upstart 配置脚本的软件，仍然可以用原来的方式启动它。</p>
<p>另外，如果我们还安装了类似 <a href="http://www.tecmint.com/chkconfig-command-examples/">chkconfig</a> 的工具，你还可以和在基于 sysvinit 的系统中一样用它们管理基于 Sysv 的服务。</p>
<p>Upstart 脚本除了支持 Sysv 启动脚本，还支持基于多种方式启动或者停用服务；例如， Upstart 可以在一个特定硬件设备连接上的时候启动一个服务。</p>
<p>使用 Upstart以及它原生脚本的系统替换了 /etc/inittab 文件和 /etc/init 目录下和运行等级相关的以 .conf 作为后缀的 Sysv 启动脚本目录。</p>
<p>这些 *.conf 脚本（也称为任务定义）通常包括以下几部分：</p>
<ul>
<li>进程描述</li>
<li>进程的运行等级或者应该触发它们的事件</li>
<li>应该停止进程的运行等级或者触发停止进程的事件</li>
<li>选项</li>
<li>启动进程的命令</li>
</ul>
<p>例如，</p>
<pre style="" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="com">#</span><span class="pln"> </span><span class="typ">My</span><span class="pln"> </span><span class="kwd">test</span><span class="pln"> service </span><span class="pun">-</span><span class="pln"> </span><span class="typ">Upstart</span><span class="pln"> </span><span class="kwd">script</span><span class="pln"> demo description </span><span class="str">"Here goes the description of 'My test service'"</span><span class="pln"> author </span><span class="str">"Dave Null &lt;dave.null@example.com&gt;"</span></code></li><li class="L1"><code><span class="com">#</span><span class="pln"> </span><span class="typ">Stanzas</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="com">#</span></code></li><li class="L4"><code><span class="com">#</span><span class="pln"> </span><span class="typ">Stanzas</span><span class="pln"> </span><span class="kwd">define</span><span class="pln"> </span><span class="kwd">when</span><span class="pln"> </span><span class="kwd">and</span><span class="pln"> how a process </span><span class="kwd">is</span><span class="pln"> started </span><span class="kwd">and</span><span class="pln"> stopped</span></code></li><li class="L5"><code><span class="com">#</span><span class="pln"> </span><span class="typ">See</span><span class="pln"> a </span><span class="kwd">list</span><span class="pln"> of stanzas here</span><span class="pun">:</span><span class="pln"> http</span><span class="pun">:</span><span class="com">//upstart.ubuntu.com/wiki/Stanzas#respawn</span></code></li><li class="L6"><code><span class="com">#</span><span class="pln"> </span><span class="typ">When</span><span class="pln"> to start the service</span></code></li><li class="L7"><code><span class="pln">start on </span><span class="kwd">runlevel</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2345</span><span class="pun">]</span></code></li><li class="L8"><code><span class="com">#</span><span class="pln"> </span><span class="typ">When</span><span class="pln"> to stop the service</span></code></li><li class="L9"><code><span class="pln">stop on </span><span class="kwd">runlevel</span><span class="pln"> </span><span class="pun">[</span><span class="lit">016</span><span class="pun">]</span></code></li><li class="L0"><code><span class="com">#</span><span class="pln"> </span><span class="typ">Automatically</span><span class="pln"> restart process </span><span class="kwd">in</span><span class="pln"> </span><span class="kwd">case</span><span class="pln"> of crash</span></code></li><li class="L1"><code><span class="pln">respawn</span></code></li><li class="L2"><code><span class="com">#</span><span class="pln"> </span><span class="typ">Specify</span><span class="pln"> working directory</span></code></li><li class="L3"><code><span class="pln">chdir </span><span class="pun">/</span><span class="pln">home</span><span class="pun">/</span><span class="pln">dave</span><span class="pun">/</span><span class="pln">myfiles</span></code></li><li class="L4"><code><span class="com">#</span><span class="pln"> </span><span class="typ">Specify</span><span class="pln"> the process</span><span class="pun">/</span><span class="pln">command </span><span class="pun">(</span><span class="pln">add arguments </span><span class="kwd">if</span><span class="pln"> needed</span><span class="pun">)</span><span class="pln"> to run</span></code></li><li class="L5"><code><span class="kwd">exec</span><span class="pln"> </span><span class="kwd">bash</span><span class="pln"> backup</span><span class="pun">.</span><span class="pln">sh arg1 arg2</span></code></li></ol></pre>
<p>要使更改生效，你要让 upstart 重新加载它的配置文件。</p>
<pre style="" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="com">#</span><span class="pln"> initctl reload</span><span class="pun">-</span><span class="pln">configuration</span></code></li></ol></pre>
<p>然后用下面的命令启动你的任务。</p>
<pre style="" class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln">$ </span><span class="kwd">sudo</span><span class="pln"> start yourjobname</span></code></li></ol></pre>
<p>其中 yourjobname 是之前 yourjobname.conf 脚本中添加的任务名称。</p>
<p>关于 Upstart 更完整和详细的介绍可以参考该项目网站的 “<a href="http://upstart.ubuntu.com/cookbook/">Cookbook</a>” 栏目。</p><!--/DOCUMENT_FRAGMENT--></div></div></div></div></div></div></body>
</html>
