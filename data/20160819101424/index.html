<!DOCTYPE html>
<html lang="en-US" dir="ltr">
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"> <title>Iptables Limits Connections Per IP</title><link rel="canonical" href="http://www.cyberciti.biz/faq/iptables-connection-limits-howto/"><link rel="alternate" type="application/rss+xml" title="nixCraft feed" href="http://www.cyberciti.biz/faq/feed/"><link rel="pingback" href="http://www.cyberciti.biz/faq/xmlrpc.php"><link rel="dns-prefetch" href="http://s.w.org/"><link rel="alternate" type="application/rss+xml" title="nixCraft » Iptables Limits Connections Per IP Comments Feed" href="http://www.cyberciti.biz/faq/iptables-connection-limits-howto/feed/">   <link rel="https://api.w.org/" href="http://www.cyberciti.biz/faq/wp-json/"><link rel="alternate" type="application/json+oembed" href="http://www.cyberciti.biz/faq/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fwww.cyberciti.biz%2Ffaq%2Fiptables-connection-limits-howto%2F"><link rel="alternate" type="text/xml+oembed" href="http://www.cyberciti.biz/faq/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fwww.cyberciti.biz%2Ffaq%2Fiptables-connection-limits-howto%2F&amp;format=xml"><meta name="description" content="Explains howto use iptables to rate-limit incoming connections for port 80, 443, 25 to limit number of connections per IP. "><link rel="shortcut icon" href="favicon.ico">
<link rel="stylesheet" type="text/css" href="index.css" media="all">
</head><body class="template-single">  <div class="container"> <span class="menu_control">≡ Menu</span><ul id="menu-faq" class="menu"><li id="menu-item-145282" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-145282"><a title="nixCraft – Home Page " href="http://www.cyberciti.biz/">Home</a></li><li id="menu-item-145280" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-145280"><a title="About us" href="http://www.cyberciti.biz/tips/about-us">About</a></li><li id="menu-item-145283" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-145283"><a href="https://bash.cyberciti.biz/guide/Main_Page">Linux Shell Scripting TutoriaL</a></li><li id="menu-item-145281" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-145281"><a title="Rss Feed" href="http://www.cyberciti.biz/nixcraft-rss-feed-syndication/">RSS/Feed</a></li></ul><div id="header" class="header"><div id="site_title"><a href="http://www.cyberciti.biz/faq">nixCraft</a></div><div id="site_tagline">Linux and Unix tutorials for new and seasoned sysadmin.</div></div><div class="columns"><div class="content"><div id="post-6434" class="post_box grt top" itemscope="" itemtype="http://schema.org/Article"><meta itemscope="" itemprop="mainEntityOfPage" itemtype="https://schema.org/WebPage" itemid="http://www.cyberciti.biz/faq/iptables-connection-limits-howto/"><div class="headline_area"><h1 class="headline" itemprop="headline">Iptables Limits Connections Per IP</h1><div class="byline small"> <span class="post_author_intro">by</span> <span class="post_author">Vivek Gite</span> <span class="post_date_intro">on</span> <span class="post_date" title="2010-02-07">February 7, 2010<span style="font-style: italic; text-transform: lowercase;"> last updated </span>February 9, 2010</span><div class="post_cats"> <span class="post_cats_intro">in</span> <a href="http://www.cyberciti.biz/faq/category/iptables/" rel="category tag">Iptables</a></div></div></div><div class="post_content"><div style="float: right; margin-top: 0px; margin-left: 5px;"><a href="http://www.cyberciti.biz/faq/category/iptables/" title="See all Firewall related FAQ"><img src="firewall.png" border="0"></a></div><p><span class="drop_cap">H</span>ow do I restrict the number of connections used by a single IP address to my server for port 80 and 25 using iptables?<br> <span id="more-6434"></span><br> You need to use the connlimit modules which allows you to restrict the number of parallel TCP connections to a server per client IP address (or address block).</p><p></p><center>  <ins class="adsbygoogle" style="display: inline-block; width: 336px; height: 280px;" data-ad-client="ca-pub-7825705102693166" data-ad-slot="2404767461"></ins> <p></p></center><p></p><p>This is useful to protect your server or vps box against flooding, spamming or content scraping.</p><h2>Syntax</h2><p>The syntax is as follows:</p><pre>/sbin/iptables -A INPUT -p tcp --syn --dport $port -m connlimit --connlimit-above N -j REJECT --reject-with tcp-reset
# save the changes see iptables-save man page, the following is redhat and friends specific command
service iptables save</pre><h3>Example: Limit SSH Connections Per IP / Host</h3><p>Only allow 3 ssg connections per client host:</p><pre>/sbin/iptables  -A INPUT -p tcp --syn --dport 22 -m connlimit --connlimit-above 3 -j REJECT
# save the changes see iptables-save man page, the following is redhat and friends specific command
service iptables save</pre><h3>Example: Limit HTTP Connections Per IP / Host</h3><p>Only allow 20 http connections per IP (MaxClients is set to 60 in httpd.conf):</p><div style="padding: 2px 0px 2px 0.5em; background: none repeat scroll 0% 0% rgb(251, 251, 251); border-width: 1px 1px 1px 10px; border-style: solid; border-color: rgb(170, 170, 170) rgb(170, 170, 170) rgb(170, 170, 170) rgb(178, 34, 34); -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-image: none;"><img style="vertical-align: middle;" src="warning-40px.png" title="Warning examples may block proxy servers"><strong>WARNING!</strong> Please note that  large proxy servers may legitimately create a large number of connections to your server. You can skip those ips using <a href="http://www.cyberciti.biz/faq/iptables-invert-ip-or-protocol-with/">! syntax</a></div><pre>/sbin/iptables -A INPUT -p tcp --syn --dport 80 -m connlimit --connlimit-above 20 -j REJECT --reject-with tcp-reset
# save the changes see iptables-save man page, the following is redhat and friends specific command
service iptables save</pre><p>Skip proxy server IP 1.2.3.4 from this kind of limitations:</p><pre>/sbin/iptables -A INPUT -p tcp --syn --dport 80 -d ! 1.2.3.4 -m connlimit --connlimit-above 20 -j REJECT --reject-with tcp-reset</pre><h3>Example: Class C Limitations</h3><p>In this example, limit the  parallel http requests to 20 per class C sized network (24 bit netmask)</p><pre>/sbin/iptables  -A INPUT -p tcp --syn --dport 80 -m connlimit --connlimit-above 20 --connlimit-mask 24 -j REJECT --reject-with tcp-reset
# save the changes see iptables-save man page
service iptables save</pre><h3>Example: Limit Connections Per Second</h3><p>The following example will drop incoming connections if IP make more than 10 connection attempts to port 80 within 100 seconds (add rules to your iptables shell script)</p><div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="bash" style="font-family: monospace;"><span style="color: rgb(102, 102, 102); font-style: italic;">#!/bin/bash</span>
<span style="color: rgb(0, 120, 0);">IPT</span>=<span style="color: rgb(0, 0, 0); font-weight: bold;">/</span>sbin<span style="color: rgb(0, 0, 0); font-weight: bold;">/</span>iptables
<span style="color: rgb(102, 102, 102); font-style: italic;"># Max connection in seconds</span>
<span style="color: rgb(0, 120, 0);">SECONDS</span>=<span style="color: rgb(0, 0, 0);">100</span>
<span style="color: rgb(102, 102, 102); font-style: italic;"># Max connections per IP</span>
<span style="color: rgb(0, 120, 0);">BLOCKCOUNT</span>=<span style="color: rgb(0, 0, 0);">10</span>
<span style="color: rgb(102, 102, 102); font-style: italic;"># ....</span>
<span style="color: rgb(102, 102, 102); font-style: italic;"># ..</span>
<span style="color: rgb(102, 102, 102); font-style: italic;"># default action can be DROP or REJECT</span>
<span style="color: rgb(0, 120, 0);">DACTION</span>=<span style="color: rgb(255, 0, 0);">"DROP"</span>
<span style="color: rgb(0, 120, 0);">$IPT</span> <span style="color: rgb(102, 0, 51);">-A</span> INPUT <span style="color: rgb(102, 0, 51);">-p</span> tcp <span style="color: rgb(102, 0, 51);">--dport</span> <span style="color: rgb(0, 0, 0);">80</span> <span style="color: rgb(102, 0, 51);">-i</span> eth0 <span style="color: rgb(102, 0, 51);">-m</span> state <span style="color: rgb(102, 0, 51);">--state</span> NEW <span style="color: rgb(102, 0, 51);">-m</span> recent <span style="color: rgb(102, 0, 51);">--set</span>
<span style="color: rgb(0, 120, 0);">$IPT</span> <span style="color: rgb(102, 0, 51);">-A</span> INPUT <span style="color: rgb(102, 0, 51);">-p</span> tcp <span style="color: rgb(102, 0, 51);">--dport</span> <span style="color: rgb(0, 0, 0);">80</span> <span style="color: rgb(102, 0, 51);">-i</span> eth0 <span style="color: rgb(102, 0, 51);">-m</span> state <span style="color: rgb(102, 0, 51);">--state</span> NEW <span style="color: rgb(102, 0, 51);">-m</span> recent <span style="color: rgb(102, 0, 51);">--update</span> <span style="color: rgb(102, 0, 51);">--seconds</span> <span style="color: rgb(128, 0, 0);">${SECONDS}</span> <span style="color: rgb(102, 0, 51);">--hitcount</span> <span style="color: rgb(128, 0, 0);">${BLOCKCOUNT}</span> <span style="color: rgb(102, 0, 51);">-j</span> <span style="color: rgb(128, 0, 0);">${DACTION}</span>
<span style="color: rgb(102, 102, 102); font-style: italic;"># ....</span>
<span style="color: rgb(102, 102, 102); font-style: italic;"># ..</span></pre></td></tr></tbody></table></div><h2>How Do I Test My Firewall Working?</h2><p>Use the following shell script to connect to your web server hosted at 202.1.2.3:</p><div class="wp_syntax"><table><tbody><tr><td class="code"><pre class="bash" style="font-family: monospace;"><span style="color: rgb(102, 102, 102); font-style: italic;">#!/bin/bash</span>
<span style="color: rgb(0, 120, 0);">ip</span>=<span style="color: rgb(255, 0, 0);">"202.1.2.3"</span>
<span style="color: rgb(0, 120, 0);">port</span>=<span style="color: rgb(255, 0, 0);">"80"</span>
<span style="color: rgb(0, 0, 0); font-weight: bold;">for</span> i <span style="color: rgb(0, 0, 0); font-weight: bold;">in</span> <span style="color: rgb(122, 8, 116); font-weight: bold;">{</span><span style="color: rgb(0, 0, 0);">1</span>..<span style="color: rgb(0, 0, 0);">100</span><span style="color: rgb(122, 8, 116); font-weight: bold;">}</span>
<span style="color: rgb(0, 0, 0); font-weight: bold;">do</span>
  <span style="color: rgb(102, 102, 102); font-style: italic;"># do nothing just connect and exit</span>
  <span style="color: rgb(122, 8, 116); font-weight: bold;">echo</span> <span style="color: rgb(255, 0, 0);">"exit"</span> <span style="color: rgb(0, 0, 0); font-weight: bold;">|</span> nc <span style="color: rgb(128, 0, 0);">${ip}</span> <span style="color: rgb(128, 0, 0);">${port}</span>;
<span style="color: rgb(0, 0, 0); font-weight: bold;">done</span></pre></td></tr></tbody></table></div><h4>References:</h4><ul><li><a href="http://www.cyberciti.biz/tips/lighttpd-set-throughput-connections-per-ip.html">Lighttpd Traffic Shaping: Throttle Connections Per Single IP (Rate Limit)</a></li><li>man page – iptables</li></ul> <strong>Share this tutorial on:</strong><div class="nixcraft-social"><a class="nixcraft-link nixcraft-twitter" href="https://twitter.com/intent/tweet?text=Iptables+Limits+Connections+Per+IP&amp;url=http://www.cyberciti.biz/faq/iptables-connection-limits-howto/&amp;via=nixcraft" title="Tweet this tutorial/page">Twitter</a><a class="nixcraft-link nixcraft-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://www.cyberciti.biz/faq/iptables-connection-limits-howto/" title="Share this page/tutorial on Facebook">Facebook</a><a class="nixcraft-link nixcraft-googleplus" href="https://plus.google.com/share?url=http://www.cyberciti.biz/faq/iptables-connection-limits-howto/" title="Share this page/tutorial on Google+">Google+</a><a class="nixcraft-link nixcraft-pdf" href="http://www.cyberciti.biz/view/pdf/faq/6434.php" title="Download this tutorial/faq as a free pdf">Download PDF version </a><a class="nixcraft-link nixcraft-error" href="https://nixcraft.wufoo.com/forms/give-us-feedback-for-nixcraft/def/Field209=http://www.cyberciti.biz/faq/iptables-connection-limits-howto/&amp;Field211=Iptables%20Limits%20Connections%20Per%20IP" target="_blank" title="Click here to report Typo/Grammar and other Incorrect information">Found an error/typo on this page?</a></div><div class="crp_related "><div class="my_tutorial_series">About the author: Vivek Gite is a seasoned sysadmin and a trainer for the Linux/Unix &amp; shell scripting. Follow him on <strong><a href="https://twitter.com/nixcraft" style="text-decoration: underline;">Twitter</a></strong>. OR <strong>read more like this</strong>:<ul><li><a href="http://www.cyberciti.biz/faq/iptables-block-port/" class="crp_title">Linux: Block Port With IPtables</a></li><li><a href="http://www.cyberciti.biz/faq/iptables-passive-ftp-is-not-working/" class="crp_title">Linux Passive FTP Not Working Problem And Solution</a></li><li><a href="http://www.cyberciti.biz/faq/howto-rhel-linux-open-port-using-iptables/" class="crp_title">Redhat / CentOS / Fedora Linux Open Port</a></li><li><a href="http://www.cyberciti.biz/faq/deleting-firewall-rules/" class="crp_title">Linux Deleting Firewall Rules</a></li><li><a href="http://www.cyberciti.biz/faq/samba-restrict-access-to-ipc-share/" class="crp_title">Samba Restrict IPC$ ( list of shared resources )</a></li><li><a href="http://www.cyberciti.biz/faq/restrict-ssh-access-use-iptable/" class="crp_title">Restrict ssh access using Iptable</a></li><li><a href="http://www.cyberciti.biz/faq/linux-iptables-open-vncserver-port-6000-5800-5900/" class="crp_title">Iptables Open VNC Port To Allow Incoming VNC Connections</a></li><li><a href="http://www.cyberciti.biz/faq/iptables-open-ftp-port-21/" class="crp_title">Iptables Open FTP Port 21 and 20</a></li><li><a href="http://www.cyberciti.biz/faq/unix-linux-mysqld-server-bind-to-more-than-one-ip-address/" class="crp_title">MySQL/MariaDB Server: Bind To Multiple IP Address</a></li><li><a href="http://www.cyberciti.biz/faq/ip6tables-ipv6-firewall-for-linux/" class="crp_title">ip6tables: IPv6 Firewall For Linux</a></li></ul></div><div class="crp_clear"></div></div><p></p><center>  <ins class="adsbygoogle" style="display: block;" data-ad-client="ca-pub-7825705102693166" data-ad-slot="9863511468" data-ad-format="autorelaxed"></ins>  </center></div></div><div id="comments"><p class="comments_closed">Comments on this entry are closed.</p><ul class="comment_list"><li class="comment even thread-even depth-1" id="comment-45891"><div class="comment_head"> <span class="comment_author">Meska</span> <span class="comment_date">February 8, 2010, 11:35 am</span></div><div class="comment_text grt" id="comment-body-45891"><p>Usefull, as always ;)<br> Great tips.</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-45891" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment odd alt thread-odd thread-alt depth-1" id="comment-45893"><div class="comment_head"> <span class="comment_author">XxRa3eDxX</span> <span class="comment_date">February 8, 2010, 1:29 pm</span></div><div class="comment_text grt" id="comment-body-45893"><p>thnx For You</p><p>it’s Good ,, but some of DDos Attack Can Bypass This Rule  or it’s Very Fast To Be  rejected or ignored</p><p>can You Give me Your opinion on this statement ???</p><p>don’t Forget to change “IPT=/sbin/iptales” to “IPT=/sbin/iptables ”   ^_^</p><p>in this topic and in<br> <a href="http://www.cyberciti.biz/tips/lighttpd-set-throughput-connections-per-ip.html" rel="nofollow">http://www.cyberciti.biz/tips/lighttpd-set-throughput-connections-per-ip.html</a></p><p>thnx For You<br> XxRa3eDxX</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-45893" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment even thread-even depth-1" id="comment-45894"><div class="comment_head"> <span class="comment_author">iga</span> <span class="comment_date">February 8, 2010, 1:37 pm</span></div><div class="comment_text grt" id="comment-body-45894"><p>What about this?<br> [vpsxxx:~$]# /sbin/iptables  -p tcp –syn –dport 22 -m connlimit –connlimit-above 3 -j REJECT<br> iptables v1.4.2: no command specified<br> Try `iptables -h’ or ‘iptables –help’ for more information.</p><p>I’m running debian lenny.</p><p>regards<br> iga</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-45894" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment odd alt thread-odd thread-alt depth-1" id="comment-45896"><div class="comment_head"> <span class="comment_author">gajendra</span> <span class="comment_date">February 8, 2010, 1:59 pm</span></div><div class="comment_text grt" id="comment-body-45896"><p>Hi,</p><p>It is giving error while executing iptables -A INPUT -p tcp –syn –dport 22 -m connlimit –connlimit-above 2 -j REJECT</p><p>error : ” iptables: Unknown error 4294967295″</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-45896" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment byuser comment-author-administrator bypostauthor even thread-even depth-1" id="comment-45897"><div class="comment_head"> <span class="comment_author"><a href="http://www.cyberciti.biz/tips/about-us" rel="external nofollow" class="url">nixCraft</a></span> <span class="comment_date">February 8, 2010, 2:27 pm</span></div><div class="comment_text grt" id="comment-body-45897"><p>@ iga /  gajendra: It was a typo on my part (I forgot to add -A INPUT) to those rules. The faq has been updated. Let me know if you’ve any more problems.</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-45897" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment odd alt thread-odd thread-alt depth-1" id="comment-45898"><div class="comment_head"> <span class="comment_author">luc15</span> <span class="comment_date">February 8, 2010, 2:29 pm</span></div><div class="comment_text grt" id="comment-body-45898"><p>Nice indeed.</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-45898" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment even thread-even depth-1" id="comment-45899"><div class="comment_head"> <span class="comment_author">gajendra</span> <span class="comment_date">February 8, 2010, 4:18 pm</span></div><div class="comment_text grt" id="comment-body-45899"><p>My problem is while executing below command<br> iptables -A INPUT -p tcp â€“syn â€“dport 22 -m connlimit â€“connlimit-above 2 -j REJECT<br> It is giving error ” iptables: Unknown error 4294967295″</p><p>Please help me to solve this..</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-45899" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment byuser comment-author-administrator bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-45900"><div class="comment_head"> <span class="comment_author"><a href="http://www.cyberciti.biz/tips/about-us" rel="external nofollow" class="url">nixCraft</a></span> <span class="comment_date">February 8, 2010, 4:37 pm</span></div><div class="comment_text grt" id="comment-body-45900"><p>@gajendra,</p><p>This error means either you are using outdated version of iptables or it is not compiled. Another possibility is VPS software which may not support this feature. Are you using direct server or some sort of VPS?</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-45900" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment even thread-even depth-1" id="comment-45904"><div class="comment_head"> <span class="comment_author">Ganesan AS</span> <span class="comment_date">February 8, 2010, 8:50 pm</span></div><div class="comment_text grt" id="comment-body-45904"><p>@gajendra,</p><p>Replace the character before  syn, dport and connlimit parameters with double hiphen (ie –).</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-45904" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment odd alt thread-odd thread-alt depth-1" id="comment-45906"><div class="comment_head"> <span class="comment_author">vermin</span> <span class="comment_date">February 8, 2010, 11:42 pm</span></div><div class="comment_text grt" id="comment-body-45906"><p>Thank you for this article. Found it useful.</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-45906" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment even thread-even depth-1" id="comment-47596"><div class="comment_head"> <span class="comment_author">gandhi</span> <span class="comment_date">June 1, 2010, 4:42 pm</span></div><div class="comment_text grt" id="comment-body-47596"><p>which linux u used? it doesn’t works on centos :(</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-47596" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment odd alt thread-odd thread-alt depth-1" id="comment-52125"><div class="comment_head"> <span class="comment_author">jimmy</span> <span class="comment_date">December 12, 2010, 8:35 pm</span></div><div class="comment_text grt" id="comment-body-52125"><p>hello<br> this site great website for linux config!!<br> i am need limit connection users in 8 for download and only 1 file download on time<br> please help for limit users<br> thank you</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-52125" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment even thread-even depth-1" id="comment-55301"><div class="comment_head"> <span class="comment_author">VeselaHouba</span> <span class="comment_date">February 2, 2011, 12:09 pm</span></div><div class="comment_text grt" id="comment-body-55301"><p>quite important if You want to use this option and getting error:<br> <a href="http://www.mail-archive.com/debian-firewall@lists.debian.org/msg08695.html" rel="nofollow">http://www.mail-archive.com/debian-firewall@lists.debian.org/msg08695.html</a></p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-55301" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment odd alt thread-odd thread-alt depth-1" id="comment-56172"><div class="comment_head"> <span class="comment_author">rocky</span> <span class="comment_date">March 7, 2011, 1:18 pm</span></div><div class="comment_text grt" id="comment-body-56172"><p>Hi,</p><p>I configured connlimit for port 80 for testing purpose.and then i tried to open more connection then set limit. but rule is not working.</p><p>Rocky</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-56172" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment even thread-even depth-1" id="comment-57624"><div class="comment_head"> <span class="comment_author">maxtox</span> <span class="comment_date">April 23, 2011, 1:58 pm</span></div><div class="comment_text grt" id="comment-body-57624"><p>Hi guys,</p><p>Do you think it’s normal to have more than 162 connections per IP ?</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-57624" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment odd alt thread-odd thread-alt depth-1" id="comment-59363"><div class="comment_head"> <span class="comment_author">Oliver</span> <span class="comment_date">May 11, 2011, 5:21 pm</span></div><div class="comment_text grt" id="comment-body-59363"><p>Hi,</p><p>I used the last script to test my server, but for some reason the iptables rules wont work, I can still connect more than 20 times in 60 seconds.</p><p>I am using CSF .. is there any conflict then?</p><p>Thanks<br> Oliver</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-59363" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment even thread-even depth-1" id="comment-63062"><div class="comment_head"> <span class="comment_author">Dave</span> <span class="comment_date">October 2, 2011, 1:38 pm</span></div><div class="comment_text grt" id="comment-body-63062"><p>In order to use this I would need to establish a baseline for how many concurrent connections I need to allow. If I am a large social networking site, for example, I can’t limit concurrent connections to three if I have multiple, possibly hundreds or thousands of users, on a segment, like a dorm, all resolving to a single, or a few IP addresses. How do I measure/audit that?</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-63062" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment odd alt thread-odd thread-alt depth-1" id="comment-65156"><div class="comment_head"> <span class="comment_author">Josh</span> <span class="comment_date">December 4, 2011, 9:36 am</span></div><div class="comment_text grt" id="comment-body-65156"><p>@Dave<br> netstat -ntu | awk ‘{print $5}’ | cut -d: -f1 | sort | uniq -c | sort -nr</p><p>This will give it in a format</p><p>$NumberOfConnectionsLastMinute     $IP</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-65156" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment even thread-even depth-1" id="comment-66460"><div class="comment_head"> <span class="comment_author">Christian</span> <span class="comment_date">January 6, 2012, 3:54 pm</span></div><div class="comment_text grt" id="comment-body-66460"><p>Hi,</p><p>Very nice guide, it solved a lot of my questions, but i have a new one.</p><p>In the case that i want to limit LAN’s computers to my server, what do i do?</p><p>Example:<br> In a C class, computer 1 and 2  limit only 3 connections to a specific port of my server, not the public ip of those computers. Could i block it?</p><p>Thanks</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-66460" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment odd alt thread-odd thread-alt depth-1" id="comment-67636"><div class="comment_head"> <span class="comment_author">alibert</span> <span class="comment_date">January 28, 2012, 10:27 am</span></div><div class="comment_text grt" id="comment-body-67636"><p>whats missing/wrong when i get</p><p>ip-10-234-185-98:~# /sbin/iptables  -A INPUT -p tcp –syn –dport 22 -m connlimit –connlimit-above 3 -j REJECT<br> iptables: No chain/target/match by that name</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-67636" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment even thread-even depth-1" id="comment-69294"><div class="comment_head"> <span class="comment_author">Manjeet</span> <span class="comment_date">May 9, 2012, 9:11 am</span></div><div class="comment_text grt" id="comment-body-69294"><p>Can we make zero  connlimit in iptables? what will happen if I make it zero?<br> -A INPUT  -p tcp –syn –dport 22 -m connlimit –connlimit-above 0 -j REJECT –reject-with tcp-reset</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-69294" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment odd alt thread-odd thread-alt depth-1" id="comment-71491"><div class="comment_head"> <span class="comment_author">amin</span> <span class="comment_date">September 7, 2012, 7:34 am</span></div><div class="comment_text grt" id="comment-body-71491"><p>ask mr..</p><p>where is script for limited /IP address?<br> and where is Ip address limited?</p><p>please reaply mr..</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-71491" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment even thread-even depth-1" id="comment-71494"><div class="comment_head"> <span class="comment_author">manjeet</span> <span class="comment_date">September 7, 2012, 1:49 pm</span></div><div class="comment_text grt" id="comment-body-71494"><p>Hi Can you  help me to set the chain rule for iptable (linux redhat) requirment is I want to restected client (per client)</p><p>connection limmet to destination IP</p><p>Request to server is that PDU rate(connection to per IP) shall be per PI. The existing IPtables needs to be enhanced to make</p><p>it per source IP of client.</p><p>Hi I have a question how to set chain rule in IPTables(linux redhat) Requirement is–&gt;<br> their is a client and server if one client Request to server then PDU rate(connection to per IP) shall be per maintained . my</p><p>existing IPtables had some rules like it has conlimit but its needs to be enhanced to make it per source IP of client ip</p><p>iptables -I INPUT -p tcp –syn –dport 22 -m state –state NEW,ESTABLISHED -m recent –set -j ACCEPT<br> iptables -I INPUT -p tcp –syn –dport 22 -m state –state NEW -m recent –update –seconds 60 –hitcount 3 -j REJECT</p><p>–reject-with tcp-reset</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-71494" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment odd alt thread-odd thread-alt depth-1" id="comment-71823"><div class="comment_head"> <span class="comment_author">manjeet</span> <span class="comment_date">September 26, 2012, 5:37 pm</span></div><div class="comment_text grt" id="comment-body-71823"><p>I have this rule on my firewall<br> iptables -I INPUT -p tcp â€“syn â€“dport 9080 -m state â€“state NEW,ESTABLISHED -m recent â€“set -j ACCEPT<br> iptables -I INPUT -p tcp â€“syn â€“dport 9080 -m state â€“state NEW -m recent â€“update â€“seconds 60 â€“hitcount 3 -j REJECT<br> â€“reject-with tcp-reset<br> few day ago it was working fine but  idk what i am doing wrong but now the time frame of this rule now reset with last request even if it was rejected , just because of it no request com into the system only first 3 request comes in and if I wait for one min then again i am able to send new request in 60 seconds</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-71823" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment even thread-even depth-1" id="comment-72396"><div class="comment_head"> <span class="comment_author">Carl Hjerpe</span> <span class="comment_date">October 21, 2012, 6:08 pm</span></div><div class="comment_text grt" id="comment-body-72396"><p>:~# iptables -A INPUT -p tcp –syn –dport 80 -m connlimit –connlimit-above 4 -j REJECT –reject-with tcp-reset<br> iptables: No chain/target/match by that name.</p><p>Debian Squeeze</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-72396" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment odd alt thread-odd thread-alt depth-1" id="comment-73084"><div class="comment_head"> <span class="comment_author">nicolethomson</span> <span class="comment_date">November 10, 2012, 4:18 am</span></div><div class="comment_text grt" id="comment-body-73084"><p>good writeup.</p><p>Could you please light up some more internal’s?</p><p>/sbin/iptables -A INPUT -p tcp –syn –dport 80 -m connlimit –connlimit-above 20 -j REJECT –reject-with tcp-reset</p><p>is for all the ip’s,</p><p>What should i do, if it is for specific source ip?</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-73084" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment even thread-even depth-1" id="comment-74076"><div class="comment_head"> <span class="comment_author">manojkumar</span> <span class="comment_date">November 25, 2012, 12:34 pm</span></div><div class="comment_text grt" id="comment-body-74076"><p>/sbin/iptables -A INPUT -p tcp –syn –dport 22 -m connlimit –connlimit-above 8 -j REJECT<br> iptables: Unknown error 18446744073709551615</p><p>Am getting ablove error , am running this in one of AWS ec2 machine, I need to limit no of concurrent SSH connections</p><p>Please help me</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-74076" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment odd alt thread-odd thread-alt depth-1" id="comment-77612"><div class="comment_head"> <span class="comment_author"><a href="http://zverushka.net/" rel="external nofollow" class="url">detski sait</a></span> <span class="comment_date">January 21, 2013, 7:55 am</span></div><div class="comment_text grt" id="comment-body-77612"><p>Please, let me know, How can I exclude IP from that rule?</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-77612" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment even thread-even depth-1" id="comment-81403"><div class="comment_head"> <span class="comment_author">liunx</span> <span class="comment_date">March 6, 2013, 8:55 am</span></div><div class="comment_text grt" id="comment-body-81403"><p>wonderful tutorials!</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-81403" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment odd alt thread-odd thread-alt depth-1" id="comment-94667"><div class="comment_head"> <span class="comment_author">Heshan</span> <span class="comment_date">June 18, 2013, 9:27 pm</span></div><div class="comment_text grt" id="comment-body-94667"><p>I want to limit traffic from a specific IP address. As an example, only serve requests from IP address xxx.xxx.xxx.56, in 10 requests per second. Can I do it with IP tables? If so how?</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-94667" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment even thread-even depth-1" id="comment-97314"><div class="comment_head"> <span class="comment_author">Not necessary</span> <span class="comment_date">August 20, 2013, 4:12 pm</span></div><div class="comment_text grt" id="comment-body-97314"><p>How can i donate? I’ve been looking for this since forever. Thank you so much!</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-97314" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment odd alt thread-odd thread-alt depth-1" id="comment-98215"><div class="comment_head"> <span class="comment_author">Alexander</span> <span class="comment_date">September 11, 2013, 7:19 am</span></div><div class="comment_text grt" id="comment-body-98215"><p>Nice post, it helped me a lot !</p><p>One question though, how long stay’s an IP blocked by this rule.. It used the test script from another location and the rules seems to work very well :-) But when do I have access again ?</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-98215" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment even thread-even depth-1" id="comment-99035"><div class="comment_head"> <span class="comment_author">Josiah Ritchie</span> <span class="comment_date">October 3, 2013, 6:46 pm</span></div><div class="comment_text grt" id="comment-body-99035"><p>To test this stuff out on web servers, I find the easiest thing is to run ‘wget -m <a href="http://location/" rel="nofollow">http://location</a>‘ which is just wget’s mirror command. It pulls down the entire site until the rules stop responding.</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-99035" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment odd alt thread-odd thread-alt depth-1" id="comment-157312"><div class="comment_head"> <span class="comment_author">Edward Fernando</span> <span class="comment_date">May 6, 2014, 6:42 am</span></div><div class="comment_text grt" id="comment-body-157312"><p>Hi Guys.. I wanna know,<br> I want to use limit TCP connection via router so I used chain FORWARD. Can iptables limit TCP connection with port 80 in 40 max connection in 1 minute ( 60 seconds ) ? If it can be happen, how I can monitoring the traffic that the rule is work ? thx :)</p><p>NB :<br> this my rule I wanna use :</p><pre>iptables -A FORWARD -p tcp â€“dport 80 -m state â€“state NEW,ESTABLISHED -m recent â€“set -j ACCEPT
iptables -A FORWARD -p tcp â€“dport 80 -m state â€“state NEW -m recent â€“update â€“seconds 60 â€“hitcount 40 -j REJECT â€“reject-with tcp-reset
</pre></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-157312" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment even thread-even depth-1" id="comment-326856"><div class="comment_head"> <span class="comment_author">Upendra</span> <span class="comment_date">October 3, 2014, 6:03 pm</span></div><div class="comment_text grt" id="comment-body-326856"><p>When I am trying to skip an IP ( our Public IP )  I am getting error<br> Bad argument `1.2.3.4′<br> I am using same command as given in above<br> /sbin/iptables -A INPUT -p tcp –syn –dport 80 -d ! 1.2.3.4 -m connlimit –connlimit-above 20 -j REJECT –reject-with tcp-reset<br> Please suggest.</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-326856" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment odd alt thread-odd thread-alt depth-1" id="comment-773241"><div class="comment_head"> <span class="comment_author">Thao Pham</span> <span class="comment_date">January 7, 2016, 3:39 am</span></div><div class="comment_text grt" id="comment-body-773241"><p>Hi,</p><p>On Example: Limit Connections Per Second.</p><p>Can u tell me how to ignore an ip or range ip connect to my server?</p></div><div class="comment_footer"> <a class="comment_permalink" href="#comment-773241" title="permalink to this comment" rel="nofollow">Link</a></div></li></ul></div><div class="prev_next"><p class="next_post">Next FAQ: <a href="http://www.cyberciti.biz/faq/display-show-linux-partitions/" rel="next">Show Linux Partitions Command</a></p><p class="previous_post">Previous FAQ: <a href="http://www.cyberciti.biz/faq/php-resources-limits/" rel="prev">PHP Security: Limit Resources Used By Script</a></p></div></div><div style="position: relative; overflow: visible; box-sizing: border-box; min-height: 1px;" class="sidebar"><div style="padding-top: 1px; padding-bottom: 1px; position: static;" class="theiaStickySidebar"><div class="extendedwopts-show extendedwopts-desktop widget widget_text" id=""><div class="textwidget"><div id="bsap_1304534" class="bsarocks bsap_bccb43591680e039e32e874cbcc9e431"></div></div></div><div class="widget search-form" id="thesis-search-widget-3"><form class="search_form" method="get" action="http://www.cyberciti.biz/faq"><p> <input class="input_text" id="s" name="s" value="To search, type and hit enter" type="text"> <input id="searchsubmit" value="Search" type="hidden"></p></form></div><div class="extendedwopts-show extendedwopts-desktop widget widget_text" id=""><div class="textwidget"><ins class="adsbygoogle" style="display: inline-block; width: 300px; height: 600px;" data-ad-client="ca-pub-7825705102693166" data-ad-slot="3521177162"></ins> </div></div><div class="extendedwopts-show extendedwopts-desktop widget widget_text" id=""><p class="widget_title">Featured Articles:</p><div class="textwidget"><ul><li><a href="http://www.cyberciti.biz/open-source/30-cool-best-open-source-softwares-of-2013/">30 Cool Open Source Software I Discovered in 2013</a></li><li><a href="http://www.cyberciti.biz/tips/bash-aliases-mac-centos-linux-unix.html">30 Handy Bash Shell Aliases For Linux / Unix / Mac OS X</a></li><li><a href="http://www.cyberciti.biz/networking/nmap-command-examples-tutorials/">Top 30 Nmap Command Examples For Sys/Network Admins</a></li><li><a href="http://www.cyberciti.biz/tips/php-security-best-practices-tutorial.html">25 PHP Security Best Practices For Sys Admins</a></li><li><a href="http://www.cyberciti.biz/tips/top-linux-monitoring-tools.html">20 Linux System Monitoring Tools Every SysAdmin Should Know</a></li><li><a href="http://www.cyberciti.biz/tips/linux-security.html">20 Linux Server Hardening Security Tips</a></li><li><a href="http://www.cyberciti.biz/tips/linux-iptables-examples.html">Linux: 20 Iptables Examples For New SysAdmins</a></li><li><a href="http://www.cyberciti.biz/tips/linux-unix-bsd-openssh-server-best-practices.html">Top 20 OpenSSH Server Best Security Practices </a></li><li><a href="http://www.cyberciti.biz/tips/linux-unix-bsd-nginx-webserver-security.html">Top 20 Nginx WebServer Best Security Practices</a></li><li><a href="http://www.cyberciti.biz/tips/check-unix-linux-configuration-file-for-syntax-errors.html">20 Examples: Make Sure Unix / Linux Configuration Files Are Free From Syntax Errors</a></li><li><a href="http://www.cyberciti.biz/open-source/best-terminal-applications-for-linux-unix-macosx/">15 Greatest Open Source Terminal Applications Of 2012</a></li><li><a href="http://www.cyberciti.biz/tips/my-10-unix-command-line-mistakes.html">My 10 UNIX Command Line Mistakes</a></li><li><a href="http://www.cyberciti.biz/tips/open-source-project-management-software.html">Top 10 Open Source Web-Based Project Management Software</a></li><li><a href="http://www.cyberciti.biz/tips/download-email-client-for-linux-mac-osx-windows.html">Top 5 Email Client For Linux, Mac OS X, and Windows Users</a></li><li><a href="http://www.cyberciti.biz/tips/linux-laptop.html">The Novice Guide To Buying A Linux Laptop</a></li></ul></div></div><div class="extendedwopts-show extendedwopts-desktop extendedwopts-md-center widget widget_text" id=""><div class="textwidget">  <ins class="adsbygoogle" style="display: inline-block; width: 300px; height: 1057px;" data-ad-client="ca-pub-7825705102693166" data-ad-slot="6636490668"></ins> </div></div><div class="extendedwopts-show extendedwopts-desktop widget widget_text" id=""><p class="widget_title">Don’t Miss Any Linux Tips</p><div class="textwidget"><form style="border: 1px solid rgb(204, 204, 204); padding: 3px; text-align: center;" action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow"><p>Get nixCraft in your inbox. It's free:</p><p><input value="Your email address" style="width: 140px;" name="email" type="text"></p><input value="Nixcraft-LinuxFreebsdSolarisTipsTricks" name="uri" type="hidden"><input name="loc" value="en_US" type="hidden"><input value="Subscribe" type="submit"></form></div></div><div class="extendedwopts-show extendedwopts-desktop widget widget_text" id=""><div class="textwidget"><center> <ins class="adsbygoogle" style="display: inline-block; width: 300px; height: 250px;" data-ad-client="ca-pub-7825705102693166" data-ad-slot="2272802261"></ins>  </center></div></div></div></div></div><div class="footer"> ©2000-2016 nixCraft. All rights reserved. <a href="http://www.cyberciti.biz/tips/privacy">Privacy</a> - <a href="http://www.cyberciti.biz/tips/disclaimer">Terms of Service</a> - <a href="http://www.cyberciti.biz/tips/contact-us">Questions or Comments</a></div></div><div data-theiastickysidebar-sidebarselector="&quot;#secondary, #sidebar, .sidebar, #primary&quot;" data-theiastickysidebar-options="{&quot;containerSelector&quot;:&quot;&quot;,&quot;additionalMarginTop&quot;:0,&quot;additionalMarginBottom&quot;:0,&quot;updateSidebarHeight&quot;:false,&quot;minWidth&quot;:0,&quot;sidebarBehavior&quot;:&quot;stick-to-bottom&quot;,&quot;disableOnResponsiveLayouts&quot;:true}"></div>







</body>
</html>
