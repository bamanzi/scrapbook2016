<!DOCTYPE html>
<html lang="zh-CN" class="js video maskImage placeholder js video no-maskImage">
<!--<![endif]--><head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1">

     <title>God进程监控框架  |  NoOps</title>
    
    
    
    

    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    
    <link rel="pingback" href="http://noops.me/xmlrpc.php">

    
    
    

    <link rel="alternate" type="application/rss+xml" title="NoOps » God进程监控框架 评论 Feed" href="http://noops.me/?feed=rss2&amp;p=133">









<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://noops.me/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://noops.me/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="某运维屌丝的书单" href="http://noops.me/?p=124">
<link rel="next" title="docker getting started" href="http://noops.me/?p=150">
<meta name="generator" content="WordPress 3.5.1">
<link rel="canonical" href="http://noops.me/?p=133">

<!-- Start Of Script Generated By WP-PostViews -->

<!-- End Of Script Generated By WP-PostViews -->
	

<link rel="stylesheet" type="text/css" href="index.css" media="all">
</head>

<body>
    <header role="banner">
        <hgroup>
            <h1>
                <a href="http://noops.me/" title="NoOps" rel="home">NoOps</a> 
            </h1>
            <h2 id="site-description">Ops make no ops | Ops的目标是没有Ops，嗯！</h2>
            <div class="clear"></div>
        </hgroup>
    </header>
    <nav role="navigation">
        <ul class="subscription" data-subscription="rss">
            <li><a href="http://noops.me/?feed=rss" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
        <form name="search" method="get" id="searchform" action="http://noops.me/">
    <fieldset role="search">
        <input class="search" value="" results="0" name="s" id="s" placeholder="Search">
    </fieldset><fieldset class="mobile-nav"><select><option value="">Navigate…</option><option value="http://noops.me/?feed=rss">» RSS</option></select></fieldset>
</form>        <div class="main-navigation"><ul><li><a href="http://noops.me/" title="首页">首页</a></li><li class="page_item page-item-2"><a href="http://noops.me/?page_id=2">About</a></li></ul></div>
    </nav>

<div id="main">
<div id="content">
    <div>

        
            <article class="hentry" role="article">

<header>
    <h1 class="entry-title">God进程监控框架</h1>
    <p>
        <span class="meta-prep meta-prep-author">作者： </span>
        <span class="author vcard"><a href="http://noops.me/?author=2" title="由 wilbur 发布" rel="author">wilbur</a></span>
        <span class="meta-sep"> | </span>
                    <span class="leave-reply">&nbsp; 3,946 浏览 </span>
                <span class="meta-sep"> &nbsp;|&nbsp; </span>
        <time datetime="2013-03-31T17:46:54+0000" pubdate="" data-updated="true">
            2013/03/31 &nbsp;
            5:46 下午        </time>
        <span class="edit-link"></span>
    </p>
</header>

<div id="post-133" class="post-133 post type-post status-publish format-standard hentry category-ruby category-8 tag-ruby tag-14">
    <div class="entry-content">
                <p></p><!-- Crayon Syntax Highlighter v2.1.2 -->

		<div id="crayon-578b88e91ba22" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes crayon-wrapped" data-settings=" minimize scroll-mouseover wrap" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="height: 18px ! important; line-height: 18px ! important; margin-top: -18px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools"><div class="crayon-button crayon-nums-button" title="切换显示行编号"></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"></div><div class="crayon-button crayon-wrap-button crayon-pressed" title="切换自动换行"></div><div class="crayon-button crayon-expand-button" title="Expand Code"></div><div class="crayon-button crayon-copy-button" title="Expand Code"></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"></div></div></div>
			<div class="crayon-info" style="min-height: 15px ! important; line-height: 15px ! important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size: 4; font-size: 12px ! important; line-height: 15px ! important; z-index: 0; opacity: 0; overflow: hidden;">进程监控最基本的功能：当被监控的进程退出时将它自动重启，避免由于进程意外退出而导致服务不可用。</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -26px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px ! important; line-height: 15px ! important;"><div style="height: 30px;" class="crayon-num" data-line="crayon-578b88e91ba22-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px ! important; line-height: 15px ! important;"><div class="crayon-line" id="crayon-578b88e91ba22-1">进程监控最基本的功能：当被监控的进程退出时将它自动重启，避免由于进程意外退出而导致服务不可用。</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->
<p><span style="color: rgb(0, 204, 255);"><strong>监控重启进程的方案有很多种：</strong></span></p>
<ol>
<li>最简单的方法，写个脚本fork进程运行，然后waitpid，如果获pid后就再次启动</li>
<li>最土的方法，配置cron任务，固定时间运行脚本检查进程是否存在，不存在则启动</li>
<li>百度使用qmail里的supervised程序，通过supervised监管进程。
<ul>
<li>优点：supervised可以启动daemon程序，对于非daemon需要采用nohup的方式启动。</li>
<li>缺点：每个进程都要配置自己的supervised，无法做到统一管理。</li>
<li>百度对supervised进行过改造，线上有2个分支，基本功能类似，如：进程挂掉后的重启次数、重启前调用脚本处理、重启时报警功能。</li>
</ul>
</li>
<li>使用supervisord<br>
supervisord是python写的进程监控工具（http://supervisord.org/），网上也有很详细的中文教程，提供2个工具supervisord和supervisorctl&nbsp;<p></p>
<ul>
<li>supervisord 用来启动supervisord</li>
<li>supervisorctl start/stop/restart/status [process_name] 对进程进行控制和状态查看</li>
<li>提供一个http server，能够在浏览器查看和操作进程启停。同时提供xmlrpc功能，可以自己编写CLI程序远程call supervisord的接口</li>
<li>缺点：不能对daemon程序监控，supervisord退出后会使被监管的进程也退出</li>
</ul>
</li>
<li>使用monit<br>
monit的功能基本上和supervisord类似，占用内存也非常少，大概在2M左右，不过实在不喜欢它的进程配置语法。&nbsp;<p></p>
<ul>
<li>优点：支持进程资源只用判断，当进程使用cpu/mem超过多少进行重启。当进程异常不断重启时，也支持各种条件。</li>
</ul>
</li>
<li>使用god<br>
god的功能和supervisord、monit比较类似，接下来会重点介绍God的相关功能</li>
</ol>
<h2><span style="color: rgb(0, 204, 255);">God 进程监控</span></h2>
<p>God是由ruby编写的进程监控框架(http://godrb.com)，安装、配置都很简单，大概的功能如下：<br>
<strong>优点：</strong></p>
<ol>
<ul>
<li>启动和控制都使用一个命令： god</li>
<li>可以管理daemon和非daemon进程</li>
<li>可以设置进程的uid、env、dir、log等参数</li>
<li>进程配置文件和supervisord类似，但使用ruby的语法。支持类似monit的，对进程使用资源和各种条件的控制</li>
<li>支持进程配置动态加载功能</li>
<li>支持把多个进程配置拆分成单独的配置文件，类似include功能</li>
<li>支持通知功能，包括：Webhook、Email、Twitter、Jabber、Campfire等多个接口</li>
<li>根据PID的方式进行监控，GOD可以随便升级和重启</li>
</ul>
</ol>
<p><strong>缺点：</strong></p>
<ol>
<ul>
<li>不提供web端和rpc接口</li>
<li>log查看stdrr/stdout 功能似乎不能正常work，不过我基本上用不到这个功能</li>
<li>linux下采用2种方式检测进程poll和event。root默认启用event模式，如果启动的进程错误，它会注册一个proc_exit事件，但无法响应。</li>
</ul>
</ol>
<p><strong>一、 安装</strong><br>
需要有ruby环境，&gt;= ruby 1.8.7，支持redhat、ubuntu、centos</p><!-- Crayon Syntax Highlighter v2.1.2 -->

		<div id="crayon-578b88e91ba9a" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes crayon-wrapped" data-settings=" minimize scroll-mouseover wrap" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="height: 18px ! important; line-height: 18px ! important; margin-top: -18px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools"><div class="crayon-button crayon-nums-button" title="切换显示行编号"></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"></div><div class="crayon-button crayon-wrap-button crayon-pressed" title="切换自动换行"></div><div class="crayon-button crayon-expand-button" title="Expand Code"></div><div class="crayon-button crayon-copy-button" title="Expand Code"></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"></div></div></div>
			<div class="crayon-info" style="min-height: 15px ! important; line-height: 15px ! important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size: 4; font-size: 12px ! important; line-height: 15px ! important; z-index: 0; opacity: 0; overflow: hidden;"> [sudo] gem install god</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -26px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px ! important; line-height: 15px ! important;"><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91ba9a-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px ! important; line-height: 15px ! important;"><div class="crayon-line" id="crayon-578b88e91ba9a-1"><span class="h"> </span><span class="sy">[</span><span class="i">sudo</span><span class="sy">]</span><span class="h"> </span><span class="e">gem </span><span class="e">install </span><span class="i">god</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p><span id="more-133"></span><br>
<strong>二、 一个简单的实例</strong></p>
<ol>
<li>编写一个简单的ruby程序，hello.rb:<br>
<!-- Crayon Syntax Highlighter v2.1.2 -->

		<div id="crayon-578b88e91bb18" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes crayon-wrapped" data-settings=" minimize scroll-mouseover wrap" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="height: 18px ! important; line-height: 18px ! important; margin-top: -18px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools"><div class="crayon-button crayon-nums-button" title="切换显示行编号"></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"></div><div class="crayon-button crayon-wrap-button crayon-pressed" title="切换自动换行"></div><div class="crayon-button crayon-expand-button" title="Expand Code"></div><div class="crayon-button crayon-copy-button" title="Expand Code"></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"></div></div></div>
			<div class="crayon-info" style="min-height: 15px ! important; line-height: 15px ! important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size: 4; font-size: 12px ! important; line-height: 15px ! important; z-index: 0; opacity: 0; overflow: hidden;">loop do
  puts "hello God!"
  sleep 5
end</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -26px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px ! important; line-height: 15px ! important;"><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91bb18-1">1</div><div style="height: 15px;" class="crayon-num crayon-striped-num" data-line="crayon-578b88e91bb18-2">2</div><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91bb18-3">3</div><div style="height: 15px;" class="crayon-num crayon-striped-num" data-line="crayon-578b88e91bb18-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px ! important; line-height: 15px ! important;"><div class="crayon-line" id="crayon-578b88e91bb18-1"><span class="e">loop </span><span class="st">do</span></div><div class="crayon-line crayon-striped-line" id="crayon-578b88e91bb18-2"><span class="h">&nbsp;&nbsp;</span><span class="i">puts</span><span class="h"> </span><span class="s">"hello God!"</span></div><div class="crayon-line" id="crayon-578b88e91bb18-3"><span class="h">&nbsp;&nbsp;</span><span class="i">sleep</span><span class="h"> </span><span class="cn">5</span></div><div class="crayon-line crayon-striped-line" id="crayon-578b88e91bb18-4"><span class="st">end</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->

</li>
<li>编写进程配置文件，hello.god:<br>
<!-- Crayon Syntax Highlighter v2.1.2 -->

		<div id="crayon-578b88e91bb91" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes crayon-wrapped" data-settings=" minimize scroll-mouseover wrap" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="height: 18px ! important; line-height: 18px ! important; margin-top: -18px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools"><div class="crayon-button crayon-nums-button" title="切换显示行编号"></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"></div><div class="crayon-button crayon-wrap-button crayon-pressed" title="切换自动换行"></div><div class="crayon-button crayon-expand-button" title="Expand Code"></div><div class="crayon-button crayon-copy-button" title="Expand Code"></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"></div></div></div>
			<div class="crayon-info" style="min-height: 15px ! important; line-height: 15px ! important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size: 4; font-size: 12px ! important; line-height: 15px ! important; z-index: 0; opacity: 0; overflow: hidden;">God.watch do |w|
  w.name = "hello"
  w.start = "ruby /home/work/ruby/hello.rb"
  w.keepalive(:memory_max =&gt; 150.megabytes,
              :cpu_max =&gt; 50.percent)
end</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -26px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px ! important; line-height: 15px ! important;"><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91bb91-1">1</div><div style="height: 15px;" class="crayon-num crayon-striped-num" data-line="crayon-578b88e91bb91-2">2</div><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91bb91-3">3</div><div style="height: 15px;" class="crayon-num crayon-striped-num" data-line="crayon-578b88e91bb91-4">4</div><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91bb91-5">5</div><div style="height: 15px;" class="crayon-num crayon-striped-num" data-line="crayon-578b88e91bb91-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px ! important; line-height: 15px ! important;"><div class="crayon-line" id="crayon-578b88e91bb91-1"><span class="i">God</span><span class="sy">.</span><span class="e">watch </span><span class="st">do</span><span class="h"> </span><span class="o">|</span><span class="i">w</span><span class="o">|</span></div><div class="crayon-line crayon-striped-line" id="crayon-578b88e91bb91-2"><span class="h">&nbsp;&nbsp;</span><span class="i">w</span><span class="sy">.</span><span class="v">name</span><span class="h"> </span><span class="o">=</span><span class="h"> </span><span class="s">"hello"</span></div><div class="crayon-line" id="crayon-578b88e91bb91-3"><span class="h">&nbsp;&nbsp;</span><span class="i">w</span><span class="sy">.</span><span class="v">start</span><span class="h"> </span><span class="o">=</span><span class="h"> </span><span class="s">"ruby /home/work/ruby/hello.rb"</span></div><div class="crayon-line crayon-striped-line" id="crayon-578b88e91bb91-4"><span class="h">&nbsp;&nbsp;</span><span class="i">w</span><span class="sy">.</span><span class="e">keepalive</span><span class="sy">(</span><span class="o">:</span><span class="v">memory_max</span><span class="h"> </span><span class="o">=</span><span class="o">&gt;</span><span class="h"> </span><span class="cn">150.megabytes</span><span class="sy">,</span></div><div class="crayon-line" id="crayon-578b88e91bb91-5"><span class="h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="o">:</span><span class="v">cpu_max</span><span class="h"> </span><span class="o">=</span><span class="o">&gt;</span><span class="h"> </span><span class="cn">50.percent</span><span class="sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-578b88e91bb91-6"><span class="st">end</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0015 seconds] -->

</li>
<li>启动god，加载配置，有2种方式：
<ol>
<li>启动god同时加载配置： god -c hello.god</li>
<li>先启动god，再加载配置： god &amp;&amp; god load hello.god</li>
</ol>
</li>
</ol>
<p>这个时候可以用ps查看，hello.rb已经启动起来。使用god status 可以查看到状态如下：</p><!-- Crayon Syntax Highlighter v2.1.2 -->

		<div id="crayon-578b88e91bc0a" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes crayon-wrapped" data-settings=" minimize scroll-mouseover wrap" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="height: 18px ! important; line-height: 18px ! important; margin-top: -18px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools"><div class="crayon-button crayon-nums-button" title="切换显示行编号"></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"></div><div class="crayon-button crayon-wrap-button crayon-pressed" title="切换自动换行"></div><div class="crayon-button crayon-expand-button" title="Expand Code"></div><div class="crayon-button crayon-copy-button" title="Expand Code"></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"></div></div></div>
			<div class="crayon-info" style="min-height: 15px ! important; line-height: 15px ! important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size: 4; font-size: 12px ! important; line-height: 15px ! important; z-index: 0; opacity: 0; overflow: hidden;">hello: up</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -26px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px ! important; line-height: 15px ! important;"><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91bc0a-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px ! important; line-height: 15px ! important;"><div class="crayon-line" id="crayon-578b88e91bc0a-1"><span class="i">hello</span><span class="o">:</span><span class="h"> </span><span class="i">up</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>在hello.god配置中，我们配置了:memory_max和:cpu_max，当hello.rb使用cpu或mem超过我们配置的内容时，god就会重启该进程。</p>
<p>使用如下命令，对进程进行各种控制，具体见god –help：</p><!-- Crayon Syntax Highlighter v2.1.2 -->

		<div id="crayon-578b88e91bc89" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes crayon-wrapped" data-settings=" minimize scroll-mouseover wrap" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="height: 18px ! important; line-height: 18px ! important; margin-top: -18px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools"><div class="crayon-button crayon-nums-button" title="切换显示行编号"></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"></div><div class="crayon-button crayon-wrap-button crayon-pressed" title="切换自动换行"></div><div class="crayon-button crayon-expand-button" title="Expand Code"></div><div class="crayon-button crayon-copy-button" title="Expand Code"></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"></div></div></div>
			<div class="crayon-info" style="min-height: 15px ! important; line-height: 15px ! important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size: 4; font-size: 12px ! important; line-height: 15px ! important; z-index: 0; opacity: 0; overflow: hidden;">god start/stop/restart/status/monitor/unmonitor/remove/log [process_name]</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -26px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px ! important; line-height: 15px ! important;"><div style="height: 30px;" class="crayon-num" data-line="crayon-578b88e91bc89-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px ! important; line-height: 15px ! important;"><div class="crayon-line" id="crayon-578b88e91bc89-1"><span class="e">god </span><span class="i">start</span><span class="o">/</span><span class="i">stop</span><span class="o">/</span><span class="i">restart</span><span class="o">/</span><span class="i">status</span><span class="o">/</span><span class="i">monitor</span><span class="o">/</span><span class="i">unmonitor</span><span class="o">/</span><span class="i">remove</span><span class="o">/</span><span class="i">log</span><span class="h"> </span><span class="sy">[</span><span class="i">process_name</span><span class="sy">]</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p><strong>三、 进一步使用</strong></p>
<ol>
<li>配置文件中加载其他god文件<br>
<!-- Crayon Syntax Highlighter v2.1.2 -->

		<div id="crayon-578b88e91bd0e" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes crayon-wrapped" data-settings=" minimize scroll-mouseover wrap" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="height: 18px ! important; line-height: 18px ! important; margin-top: -18px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools"><div class="crayon-button crayon-nums-button" title="切换显示行编号"></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"></div><div class="crayon-button crayon-wrap-button crayon-pressed" title="切换自动换行"></div><div class="crayon-button crayon-expand-button" title="Expand Code"></div><div class="crayon-button crayon-copy-button" title="Expand Code"></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"></div></div></div>
			<div class="crayon-info" style="min-height: 15px ! important; line-height: 15px ! important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size: 4; font-size: 12px ! important; line-height: 15px ! important; z-index: 0; opacity: 0; overflow: hidden;">God.load "/home/god/conf/*.god"</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -26px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px ! important; line-height: 15px ! important;"><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91bd0e-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px ! important; line-height: 15px ! important;"><div class="crayon-line" id="crayon-578b88e91bd0e-1"><span class="i">God</span><span class="sy">.</span><span class="v">load</span><span class="h"> </span><span class="s">"/home/god/conf/*.god"</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->

</li>
<li>已经启动god后，使用god load 动态加载配置</li>
<li>god pid文件，root启动时在/var/run/god, 普通账号在~/.god/</li>
<li>god -D 非daemon方式运行God</li>
<li>god status 看到的状态有3种：up、unmonitored、error(一般不会出现)</li>
<li>god支持设置uid,pid,dir,chroot,env等各种参数，详细见godrb.com</li>
<li>进程启动触发邮件发送，配置如下：<br>
<!-- Crayon Syntax Highlighter v2.1.2 -->

		<div id="crayon-578b88e91bd92" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes crayon-wrapped" data-settings=" minimize scroll-mouseover wrap" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="height: 18px ! important; line-height: 18px ! important; margin-top: -18px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools"><div class="crayon-button crayon-nums-button" title="切换显示行编号"></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"></div><div class="crayon-button crayon-wrap-button crayon-pressed" title="切换自动换行"></div><div class="crayon-button crayon-expand-button" title="Expand Code"></div><div class="crayon-button crayon-copy-button" title="Expand Code"></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"></div></div></div>
			<div class="crayon-info" style="min-height: 15px ! important; line-height: 15px ! important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size: 4; font-size: 12px ! important; line-height: 15px ! important; z-index: 0; opacity: 0; overflow: hidden;">God::Contacts::Email.defaults do |d|
  d.from_email = 'god@xxx.com'
  d.from_name = 'God'
  d.delivery_method = :sendmail
end

God.contact(:email) do |c|
  c.name = 'wilbur'
  c.group = 'developers'
  c.to_email = 'wilbur@xxx.com'
end

w.transition(:up, :start) do |on|
  on.condition(:process_exits) do |c|
    c.notify = 'wilbur'
  end
end</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -26px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px ! important; line-height: 15px ! important;"><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91bd92-1">1</div><div style="height: 15px;" class="crayon-num crayon-striped-num" data-line="crayon-578b88e91bd92-2">2</div><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91bd92-3">3</div><div style="height: 15px;" class="crayon-num crayon-striped-num" data-line="crayon-578b88e91bd92-4">4</div><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91bd92-5">5</div><div style="height: 15px;" class="crayon-num crayon-striped-num" data-line="crayon-578b88e91bd92-6">6</div><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91bd92-7">7</div><div style="height: 15px;" class="crayon-num crayon-striped-num" data-line="crayon-578b88e91bd92-8">8</div><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91bd92-9">9</div><div style="height: 15px;" class="crayon-num crayon-striped-num" data-line="crayon-578b88e91bd92-10">10</div><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91bd92-11">11</div><div style="height: 15px;" class="crayon-num crayon-striped-num" data-line="crayon-578b88e91bd92-12">12</div><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91bd92-13">13</div><div style="height: 15px;" class="crayon-num crayon-striped-num" data-line="crayon-578b88e91bd92-14">14</div><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91bd92-15">15</div><div style="height: 15px;" class="crayon-num crayon-striped-num" data-line="crayon-578b88e91bd92-16">16</div><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91bd92-17">17</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px ! important; line-height: 15px ! important;"><div class="crayon-line" id="crayon-578b88e91bd92-1"><span class="i">God</span><span class="o">::</span><span class="i">Contacts</span><span class="o">::</span><span class="i">Email</span><span class="sy">.</span><span class="e">defaults </span><span class="st">do</span><span class="h"> </span><span class="o">|</span><span class="i">d</span><span class="o">|</span></div><div class="crayon-line crayon-striped-line" id="crayon-578b88e91bd92-2"><span class="h">&nbsp;&nbsp;</span><span class="i">d</span><span class="sy">.</span><span class="v">from_email</span><span class="h"> </span><span class="o">=</span><span class="h"> </span><span class="s">'god@xxx.com'</span></div><div class="crayon-line" id="crayon-578b88e91bd92-3"><span class="h">&nbsp;&nbsp;</span><span class="i">d</span><span class="sy">.</span><span class="v">from_name</span><span class="h"> </span><span class="o">=</span><span class="h"> </span><span class="s">'God'</span></div><div class="crayon-line crayon-striped-line" id="crayon-578b88e91bd92-4"><span class="h">&nbsp;&nbsp;</span><span class="i">d</span><span class="sy">.</span><span class="v">delivery_method</span><span class="h"> </span><span class="o">=</span><span class="h"> </span><span class="o">:</span><span class="e">sendmail</span></div><div class="crayon-line" id="crayon-578b88e91bd92-5"><span class="st">end</span></div><div class="crayon-line crayon-striped-line" id="crayon-578b88e91bd92-6">&nbsp;</div><div class="crayon-line" id="crayon-578b88e91bd92-7"><span class="i">God</span><span class="sy">.</span><span class="e">contact</span><span class="sy">(</span><span class="o">:</span><span class="i">email</span><span class="sy">)</span><span class="h"> </span><span class="st">do</span><span class="h"> </span><span class="o">|</span><span class="i">c</span><span class="o">|</span></div><div class="crayon-line crayon-striped-line" id="crayon-578b88e91bd92-8"><span class="h">&nbsp;&nbsp;</span><span class="i">c</span><span class="sy">.</span><span class="v">name</span><span class="h"> </span><span class="o">=</span><span class="h"> </span><span class="s">'wilbur'</span></div><div class="crayon-line" id="crayon-578b88e91bd92-9"><span class="h">&nbsp;&nbsp;</span><span class="i">c</span><span class="sy">.</span><span class="v">group</span><span class="h"> </span><span class="o">=</span><span class="h"> </span><span class="s">'developers'</span></div><div class="crayon-line crayon-striped-line" id="crayon-578b88e91bd92-10"><span class="h">&nbsp;&nbsp;</span><span class="i">c</span><span class="sy">.</span><span class="v">to_email</span><span class="h"> </span><span class="o">=</span><span class="h"> </span><span class="s">'wilbur@xxx.com'</span></div><div class="crayon-line" id="crayon-578b88e91bd92-11"><span class="st">end</span></div><div class="crayon-line crayon-striped-line" id="crayon-578b88e91bd92-12">&nbsp;</div><div class="crayon-line" id="crayon-578b88e91bd92-13"><span class="i">w</span><span class="sy">.</span><span class="e">transition</span><span class="sy">(</span><span class="o">:</span><span class="i">up</span><span class="sy">,</span><span class="h"> </span><span class="o">:</span><span class="i">start</span><span class="sy">)</span><span class="h"> </span><span class="st">do</span><span class="h"> </span><span class="o">|</span><span class="i">on</span><span class="o">|</span></div><div class="crayon-line crayon-striped-line" id="crayon-578b88e91bd92-14"><span class="h">&nbsp;&nbsp;</span><span class="i">on</span><span class="sy">.</span><span class="e">condition</span><span class="sy">(</span><span class="o">:</span><span class="i">process_exits</span><span class="sy">)</span><span class="h"> </span><span class="st">do</span><span class="h"> </span><span class="o">|</span><span class="i">c</span><span class="o">|</span></div><div class="crayon-line" id="crayon-578b88e91bd92-15"><span class="h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="i">c</span><span class="sy">.</span><span class="v">notify</span><span class="h"> </span><span class="o">=</span><span class="h"> </span><span class="s">'wilbur'</span></div><div class="crayon-line crayon-striped-line" id="crayon-578b88e91bd92-16"><span class="h">&nbsp;&nbsp;</span><span class="st">end</span></div><div class="crayon-line" id="crayon-578b88e91bd92-17"><span class="st">end</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0033 seconds] -->

</li>
</ol>
<p><strong>四、 经验分享</strong></p>
<ol>
<li>实际测试时，只有log功能不能正常工作</li>
<li>测试配置一个错误的w.start = “ruby ddd.rb”, ddd.rb不存在
<ol>
<li>在root环境下god默认使用event模式，由于该进程启动命令错误，注册一个proc_exit(pid_num)后，没有再次启动.<br>
使用god status 查看，进程一直是up状态，但查看进程pid不存在</li>
<li>使用poll模式进行进程监控，查看god日志。god不断重启该进程<br>
使用god status查看，进程也是up状态。查看代码，因为god在启动进程的时候会将它状态变成up状态，下次周期检查时，发现进程挂了，又重启，又将状态修改为up状态。<br>
所以在任何时刻下查看进程都是up状态，可以使用如下配置方式进行解决：&nbsp;<br>
<!-- Crayon Syntax Highlighter v2.1.2 -->

		<div id="crayon-578b88e91be19" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes crayon-wrapped" data-settings=" minimize scroll-mouseover wrap" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px ! important; line-height: 15px ! important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="height: 18px ! important; line-height: 18px ! important; margin-top: -18px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools"><div class="crayon-button crayon-nums-button" title="切换显示行编号"></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"></div><div class="crayon-button crayon-wrap-button crayon-pressed" title="切换自动换行"></div><div class="crayon-button crayon-expand-button" title="Expand Code"></div><div class="crayon-button crayon-copy-button" title="Expand Code"></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"></div></div></div>
			<div class="crayon-info" style="min-height: 15px ! important; line-height: 15px ! important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size: 4; font-size: 12px ! important; line-height: 15px ! important; z-index: 0; opacity: 0; overflow: hidden;">God.watch do |w|
  w.name = "hello"
  w.start = "ruby /home/work/ruby/hello.rb"
  w.keepalive(:memory_max =&gt; 150.megabytes,
              :cpu_max =&gt; 50.percent)
  w.lifecycle do |on|
    on.condition(:flapping) do |c|
      c.to_state = [:start, :restart]
      c.times = 5
      c.within = 5.minute
      c.transition = :unmonitored
      c.retry_in = 10.minutes
      c.retry_times = 5
      c.retry_within = 2.hours
    end
  end
end
#当进程异常，会导致god不断重启
#使用:flapping条件
#5分钟内start或者restart进程 5次，如果启动失败，修改状态为unmonitored
#10分钟后再次尝试启动，如果2个小时内，尝试5次都失败，彻底放弃</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table style="margin-left: -26px;" class="crayon-table">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px ! important; line-height: 15px ! important;"><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91be19-1">1</div><div style="height: 15px;" class="crayon-num crayon-striped-num" data-line="crayon-578b88e91be19-2">2</div><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91be19-3">3</div><div style="height: 15px;" class="crayon-num crayon-striped-num" data-line="crayon-578b88e91be19-4">4</div><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91be19-5">5</div><div style="height: 15px;" class="crayon-num crayon-striped-num" data-line="crayon-578b88e91be19-6">6</div><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91be19-7">7</div><div style="height: 15px;" class="crayon-num crayon-striped-num" data-line="crayon-578b88e91be19-8">8</div><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91be19-9">9</div><div style="height: 15px;" class="crayon-num crayon-striped-num" data-line="crayon-578b88e91be19-10">10</div><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91be19-11">11</div><div style="height: 15px;" class="crayon-num crayon-striped-num" data-line="crayon-578b88e91be19-12">12</div><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91be19-13">13</div><div style="height: 15px;" class="crayon-num crayon-striped-num" data-line="crayon-578b88e91be19-14">14</div><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91be19-15">15</div><div style="height: 15px;" class="crayon-num crayon-striped-num" data-line="crayon-578b88e91be19-16">16</div><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91be19-17">17</div><div style="height: 15px;" class="crayon-num crayon-striped-num" data-line="crayon-578b88e91be19-18">18</div><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91be19-19">19</div><div style="height: 15px;" class="crayon-num crayon-striped-num" data-line="crayon-578b88e91be19-20">20</div><div style="height: 15px;" class="crayon-num" data-line="crayon-578b88e91be19-21">21</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px ! important; line-height: 15px ! important;"><div class="crayon-line" id="crayon-578b88e91be19-1"><span class="i">God</span><span class="sy">.</span><span class="e">watch </span><span class="st">do</span><span class="h"> </span><span class="o">|</span><span class="i">w</span><span class="o">|</span></div><div class="crayon-line crayon-striped-line" id="crayon-578b88e91be19-2"><span class="h">&nbsp;&nbsp;</span><span class="i">w</span><span class="sy">.</span><span class="v">name</span><span class="h"> </span><span class="o">=</span><span class="h"> </span><span class="s">"hello"</span></div><div class="crayon-line" id="crayon-578b88e91be19-3"><span class="h">&nbsp;&nbsp;</span><span class="i">w</span><span class="sy">.</span><span class="v">start</span><span class="h"> </span><span class="o">=</span><span class="h"> </span><span class="s">"ruby /home/work/ruby/hello.rb"</span></div><div class="crayon-line crayon-striped-line" id="crayon-578b88e91be19-4"><span class="h">&nbsp;&nbsp;</span><span class="i">w</span><span class="sy">.</span><span class="e">keepalive</span><span class="sy">(</span><span class="o">:</span><span class="v">memory_max</span><span class="h"> </span><span class="o">=</span><span class="o">&gt;</span><span class="h"> </span><span class="cn">150.megabytes</span><span class="sy">,</span></div><div class="crayon-line" id="crayon-578b88e91be19-5"><span class="h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="o">:</span><span class="v">cpu_max</span><span class="h"> </span><span class="o">=</span><span class="o">&gt;</span><span class="h"> </span><span class="cn">50.percent</span><span class="sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-578b88e91be19-6"><span class="h">&nbsp;&nbsp;</span><span class="i">w</span><span class="sy">.</span><span class="e">lifecycle </span><span class="st">do</span><span class="h"> </span><span class="o">|</span><span class="i">on</span><span class="o">|</span></div><div class="crayon-line" id="crayon-578b88e91be19-7"><span class="h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="i">on</span><span class="sy">.</span><span class="e">condition</span><span class="sy">(</span><span class="o">:</span><span class="i">flapping</span><span class="sy">)</span><span class="h"> </span><span class="st">do</span><span class="h"> </span><span class="o">|</span><span class="i">c</span><span class="o">|</span></div><div class="crayon-line crayon-striped-line" id="crayon-578b88e91be19-8"><span class="h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="i">c</span><span class="sy">.</span><span class="v">to_state</span><span class="h"> </span><span class="o">=</span><span class="h"> </span><span class="sy">[</span><span class="o">:</span><span class="i">start</span><span class="sy">,</span><span class="h"> </span><span class="o">:</span><span class="i">restart</span><span class="sy">]</span></div><div class="crayon-line" id="crayon-578b88e91be19-9"><span class="h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="i">c</span><span class="sy">.</span><span class="v">times</span><span class="h"> </span><span class="o">=</span><span class="h"> </span><span class="cn">5</span></div><div class="crayon-line crayon-striped-line" id="crayon-578b88e91be19-10"><span class="h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="i">c</span><span class="sy">.</span><span class="v">within</span><span class="h"> </span><span class="o">=</span><span class="h"> </span><span class="cn">5.minute</span></div><div class="crayon-line" id="crayon-578b88e91be19-11"><span class="h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="i">c</span><span class="sy">.</span><span class="v">transition</span><span class="h"> </span><span class="o">=</span><span class="h"> </span><span class="o">:</span><span class="i">unmonitored</span></div><div class="crayon-line crayon-striped-line" id="crayon-578b88e91be19-12"><span class="h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="i">c</span><span class="sy">.</span><span class="v">retry_in</span><span class="h"> </span><span class="o">=</span><span class="h"> </span><span class="cn">10.minutes</span></div><div class="crayon-line" id="crayon-578b88e91be19-13"><span class="h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="i">c</span><span class="sy">.</span><span class="v">retry_times</span><span class="h"> </span><span class="o">=</span><span class="h"> </span><span class="cn">5</span></div><div class="crayon-line crayon-striped-line" id="crayon-578b88e91be19-14"><span class="h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="i">c</span><span class="sy">.</span><span class="v">retry_within</span><span class="h"> </span><span class="o">=</span><span class="h"> </span><span class="cn">2.hours</span></div><div class="crayon-line" id="crayon-578b88e91be19-15"><span class="h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="st">end</span></div><div class="crayon-line crayon-striped-line" id="crayon-578b88e91be19-16"><span class="h">&nbsp;&nbsp;</span><span class="st">end</span></div><div class="crayon-line" id="crayon-578b88e91be19-17"><span class="st">end</span></div><div class="crayon-line crayon-striped-line" id="crayon-578b88e91be19-18"><span class="p">#当进程异常，会导致god不断重启</span></div><div class="crayon-line" id="crayon-578b88e91be19-19"><span class="p">#使用:flapping条件</span></div><div class="crayon-line crayon-striped-line" id="crayon-578b88e91be19-20"><span class="p">#5分钟内start或者restart进程 5次，如果启动失败，修改状态为unmonitored</span></div><div class="crayon-line" id="crayon-578b88e91be19-21"><span class="p">#10分钟后再次尝试启动，如果2个小时内，尝试5次都失败，彻底放弃</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0043 seconds] -->

</li>
</ol>
</li>
<li>god使用ruby的drb进行通信，所以很容易写一个web server+xmlrpc功能，通过drb控制god.</li>
<li>god load对.god内容正确性没有检查，可以使用god load 加载一个ruby程序。</li>
</ol>
            </div>
</div>

<footer>
    <p>
        This article was posted in <a href="http://noops.me/?cat=2" title="查看 ruby 中的全部文章" rel="category">ruby</a>, <a href="http://noops.me/?cat=8" title="查看 运维工具 中的全部文章" rel="category">运维工具</a> and tagged <a href="http://noops.me/?tag=ruby" rel="tag">ruby</a>, <a href="http://noops.me/?tag=%e8%bf%9b%e7%a8%8b%e7%9b%91%e6%8e%a7" rel="tag">进程监控</a>. Bookmark the <a href="#" title="Permalink to God进程监控框架" rel="bookmark">permalink</a>. Follow comments with the <a href="http://noops.me/?feed=rss2&amp;p=133" title="Comments RSS to God进程监控框架" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
        
        <a class="comment-link" href="#respond" title="Post a Comment">Post a Comment</a> or leave a trackback: <a class="trackback-link" href="http://noops.me/wp-trackback.php?p=133" title="Trackback URL for your post" rel="trackback">Trackback URL</a>.
            </p>
</footer>

<div id="comments" class="clearfix">


    
    <div id="comments-list" class="comments">
    
        <h3 id="comments-title">
            3 Comments        </h3>
    
        <ol>
                <li id="comment-121" class="comment even thread-even depth-1">
        <div class="comment-author vcard"><img alt="" src="504d7e11a48f206d30e58506193cf054.dat" class="photo avatar avatar-80 photo" height="80" width="80"> <span class="fn n">wilbur</span></div>
        <div class="comment-meta">
            2013/04/13 at 5:29 下午 <span class="meta-sep"> </span>        </div>
        
        
        <div class="comment-content">
            <p>god log可以正常工作，以前对它的理解错了，以为它是显示stdout,stderr的log，其实是显示当前进程对应的god日志。</p>
        </div>
        
        <div class="comment-reply-link"><a class="comment-reply-link" href="http://noops.me/?p=133&amp;replytocom=121#respond">Reply</a></div>
</li>
    <li id="comment-1597" class="comment odd alt thread-odd thread-alt depth-1">
        <div class="comment-author vcard"><img alt="" src="79bc87f461b55a76fcdd2eb31ace9d1b.dat" class="photo avatar avatar-80 photo" height="80" width="80"> <span class="fn n">mtao</span></div>
        <div class="comment-meta">
            2014/07/14 at 4:50 下午 <span class="meta-sep"> </span>        </div>
        
        
        <div class="comment-content">
            <p>感觉god相比supervision和monit来讲，她显得更加灵活，不过我是根据应用场景来确定使用什么工具</p>
        </div>
        
        <div class="comment-reply-link"><a class="comment-reply-link" href="http://noops.me/?p=133&amp;replytocom=1597#respond">Reply</a></div>
</li>
    <li id="comment-3565" class="comment even thread-even depth-1">
        <div class="comment-author vcard"><img alt="" src="34be3c7c0655313619d9b91a7e6f1ee6.dat" class="photo avatar avatar-80 photo" height="80" width="80"> <span class="fn n">lovejoy</span></div>
        <div class="comment-meta">
            2015/01/18 at 2:37 上午 <span class="meta-sep"> </span>        </div>
        
        
        <div class="comment-content">
            <p>supervisord不能对daemon程序监控?不是吧</p>
        </div>
        
        <div class="comment-reply-link"><a class="comment-reply-link" href="http://noops.me/?p=133&amp;replytocom=3565#respond">Reply</a></div>
</li>
        </ol>

        
    </div>
        
    
    								<div id="respond">
				<h3 id="reply-title">发表评论 <small><a rel="nofollow" id="cancel-comment-reply-link" href="#respond" style="display: none;">取消回复</a></small></h3>
									<form action="http://noops.me/wp-comments-post.php" method="post" id="commentform">
																										<p class="comment-form-author">
                <input name="author" id="author" value="" size="30" tabindex="1" type="text">
                <label for="author"><small>姓名 (required)</small></label> </p>
<p class="comment-form-email">
                <input name="email" id="email" value="" size="30" tabindex="2" type="text">
                <label for="email"><small>电子邮件 (不会被公开) (required)</small></label> </p>
<p class="comment-form-url">
                <input name="url" id="url" value="" size="30" tabindex="3" type="text">
                <label for="url"><small>站点</small></label> </p>
												<p><textarea name="comment" id="comment" cols="58" rows="10" tabindex="4"></textarea></p>												<p class="form-submit">
							<input name="submit" id="submit" value="发表评论" type="submit">
							<input name="comment_post_ID" value="133" id="comment_post_ID" type="hidden">
<input name="comment_parent" id="comment_parent" value="0" type="hidden">
						</p>
						<p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" value="f531801e39" type="hidden"></p>					</form>
							</div><!-- #respond -->
						
</div>
</article>

        
    </div>
    <aside class="sidebar thirds">
    <section class="widget-container widget_text first odd"><h1 class="widget-title">NoOps.me</h1>			<div class="textwidget">小米运维部非官方博客，关注系统、网络、运维、私有云、安全、数据库、内核...</div>
		</section><section class="widget-container better-gh-widget even"><h1 class="widget-title">xiaomi-sa@GitHub</h1><img alt="GitHub Octocat" src="octocat.png" style="display: block; margin: 0px auto;" width="128px"><p style="text-align: center;"><a href="http://github.com/xiaomi-sa/">xiaomi-sa</a> @ GitHub</p><ul id="gh-repos"><li><a href="https://github.com/xiaomi-sa/smartdns">smartdns</a><p>基于Twisted实现的智能dns系统</p></li><li><a href="https://github.com/xiaomi-sa/frigga">frigga</a><p>类似python supervisor的进程管理工具</p></li><li><a href="https://github.com/xiaomi-sa/alertsystem">alertsystem</a><p>报警助手是针对运维人员的一款短信报警处理软件。运维人员每天会处理大量短信报警，经常会有漏报警，报警处理不及时，不重要短信频频打扰我们生活的问题。报警助手对报警进行拦截，实行分级别管理，对不同基本报警，采用不同的处理和提醒方式，让你能够高效准确的处理报警，节省更多的时间投入到工作、学习、及家庭中。</p></li><li><a href="https://github.com/xiaomi-sa/falcon-eye">falcon-eye</a><p>linux monitor tool. an agent running on your host collect and display performance data. just like https://github.com/afaqurk/linux-dash</p></li><li><a href="https://github.com/xiaomi-sa/eshell">eshell</a><p>explainshell.com cmdline tool, get content from website</p></li><li><a href="https://github.com/xiaomi-sa/ngx-lua-stats">ngx-lua-stats</a><p>stats by ngx-lua</p></li><li><a href="https://github.com/xiaomi-sa/dsnat">dsnat</a><p>dsnat(Dynamic Source Network Address Translation) 是一个基于lvs fullnat模基础上开发，dsnat位于网络的网关位置，内网server访问外网时，轮询使用网关地址池中的外网ip</p></li><li><a href="https://github.com/xiaomi-sa/tcpxm">tcpxm</a><p>基于pylibcap的抓包工具</p></li><li><a href="https://github.com/xiaomi-sa/netoops">netoops</a><p></p></li></ul>
</section>		<section class="widget-container widget_recent_entries odd">		<h1 class="widget-title">最新文章</h1>		<ul>
					<li>
				<a href="http://noops.me/?p=1873" title="AFK 文章停止更新～">AFK 文章停止更新～</a>
							<span class="post-date">2016/07/08</span>
						</li>
					<li>
				<a href="http://noops.me/?p=1868" title="DBaaS In Xiaomi">DBaaS In Xiaomi</a>
							<span class="post-date">2016/01/12</span>
						</li>
					<li>
				<a href="http://noops.me/?p=1851" title="alternative 命令学习与多版本 jdk 安装">alternative 命令学习与多版本 jdk 安装</a>
							<span class="post-date">2015/08/13</span>
						</li>
					<li>
				<a href="http://noops.me/?p=1841" title="noops.me">noops.me</a>
							<span class="post-date">2015/05/27</span>
						</li>
					<li>
				<a href="http://noops.me/?p=1837" title="小米监控系统开源">小米监控系统开源</a>
							<span class="post-date">2015/05/21</span>
						</li>
				</ul>
		</section><section class="widget-container widget_recent_comments first even"><h1 class="widget-title">最近评论</h1><ul id="recentcomments"><li class="recentcomments">wilbur 发表在《<a href="http://noops.me/?p=1837#comment-4646">小米监控系统开源</a>》</li><li class="recentcomments">添明 发表在《<a href="http://noops.me/?p=1837#comment-4645">小米监控系统开源</a>》</li><li class="recentcomments">冠宇 发表在《<a href="http://noops.me/?p=653#comment-4635">DNS support edns-client-subnet</a>》</li><li class="recentcomments">李 彬 发表在《<a href="http://noops.me/?p=1868#comment-4632">DBaaS In Xiaomi</a>》</li><li class="recentcomments"><a href="https://github.com/toontong" rel="external nofollow" class="url">黄传通</a> 发表在《<a href="http://noops.me/?p=1868#comment-4631">DBaaS In Xiaomi</a>》</li></ul></section><section class="widget-container widget_archive odd"><h1 class="widget-title">文章归档</h1>		<ul>
			<li><a href="http://noops.me/?m=201607" title="2016 年七月">2016 年七月</a></li>
	<li><a href="http://noops.me/?m=201601" title="2016 年一月">2016 年一月</a></li>
	<li><a href="http://noops.me/?m=201508" title="2015 年八月">2015 年八月</a></li>
	<li><a href="http://noops.me/?m=201505" title="2015 年五月">2015 年五月</a></li>
	<li><a href="http://noops.me/?m=201504" title="2015 年四月">2015 年四月</a></li>
	<li><a href="http://noops.me/?m=201503" title="2015 年三月">2015 年三月</a></li>
	<li><a href="http://noops.me/?m=201502" title="2015 年二月">2015 年二月</a></li>
	<li><a href="http://noops.me/?m=201412" title="2014 年十二月">2014 年十二月</a></li>
	<li><a href="http://noops.me/?m=201411" title="2014 年十一月">2014 年十一月</a></li>
	<li><a href="http://noops.me/?m=201410" title="2014 年十月">2014 年十月</a></li>
	<li><a href="http://noops.me/?m=201409" title="2014 年九月">2014 年九月</a></li>
	<li><a href="http://noops.me/?m=201407" title="2014 年七月">2014 年七月</a></li>
	<li><a href="http://noops.me/?m=201404" title="2014 年四月">2014 年四月</a></li>
	<li><a href="http://noops.me/?m=201403" title="2014 年三月">2014 年三月</a></li>
	<li><a href="http://noops.me/?m=201402" title="2014 年二月">2014 年二月</a></li>
	<li><a href="http://noops.me/?m=201312" title="2013 年十二月">2013 年十二月</a></li>
	<li><a href="http://noops.me/?m=201311" title="2013 年十一月">2013 年十一月</a></li>
	<li><a href="http://noops.me/?m=201310" title="2013 年十月">2013 年十月</a></li>
	<li><a href="http://noops.me/?m=201309" title="2013 年九月">2013 年九月</a></li>
	<li><a href="http://noops.me/?m=201308" title="2013 年八月">2013 年八月</a></li>
	<li><a href="http://noops.me/?m=201307" title="2013 年七月">2013 年七月</a></li>
	<li><a href="http://noops.me/?m=201306" title="2013 年六月">2013 年六月</a></li>
	<li><a href="http://noops.me/?m=201305" title="2013 年五月">2013 年五月</a></li>
	<li><a href="http://noops.me/?m=201304" title="2013 年四月">2013 年四月</a></li>
	<li><a href="http://noops.me/?m=201303" title="2013 年三月">2013 年三月</a></li>
	<li><a href="http://noops.me/?m=201302" title="2013 年二月">2013 年二月</a></li>
		</ul>
</section><section class="widget-container widget_categories even"><h1 class="widget-title">文章分类</h1>		<ul>
	<li class="cat-item cat-item-3"><a href="http://noops.me/?cat=3" title="查看 CDN 下的所有文章">CDN</a>
</li>
	<li class="cat-item cat-item-44"><a href="http://noops.me/?cat=44" title="查看 dns 下的所有文章">dns</a>
</li>
	<li class="cat-item cat-item-82"><a href="http://noops.me/?cat=82" title="查看 golang 下的所有文章">golang</a>
</li>
	<li class="cat-item cat-item-86"><a href="http://noops.me/?cat=86" title="查看 IAAS/PAAS 下的所有文章">IAAS/PAAS</a>
</li>
	<li class="cat-item cat-item-9"><a href="http://noops.me/?cat=9" title="查看 linux系统 下的所有文章">linux系统</a>
</li>
	<li class="cat-item cat-item-66"><a href="http://noops.me/?cat=66" title="查看 lvs 下的所有文章">lvs</a>
</li>
	<li class="cat-item cat-item-20"><a href="http://noops.me/?cat=20" title="查看 mysql 下的所有文章">mysql</a>
</li>
	<li class="cat-item cat-item-27"><a href="http://noops.me/?cat=27" title="查看 Network 下的所有文章">Network</a>
</li>
	<li class="cat-item cat-item-10"><a href="http://noops.me/?cat=10" title="查看 python 下的所有文章">python</a>
</li>
	<li class="cat-item cat-item-2"><a href="http://noops.me/?cat=2" title="查看 ruby 下的所有文章">ruby</a>
</li>
	<li class="cat-item cat-item-108"><a href="http://noops.me/?cat=108" title="查看 优化 下的所有文章">优化</a>
</li>
	<li class="cat-item cat-item-11"><a href="http://noops.me/?cat=11" title="查看 咸蛋 下的所有文章">咸蛋</a>
</li>
	<li class="cat-item cat-item-65"><a href="http://noops.me/?cat=65" title="查看 基础设施 下的所有文章">基础设施</a>
</li>
	<li class="cat-item cat-item-35"><a href="http://noops.me/?cat=35" title="查看 安全 下的所有文章">安全</a>
</li>
	<li class="cat-item cat-item-109"><a href="http://noops.me/?cat=109" title="查看 服务器架构 下的所有文章">服务器架构</a>
</li>
	<li class="cat-item cat-item-18"><a href="http://noops.me/?cat=18" title="查看 虚拟化 下的所有文章">虚拟化</a>
</li>
	<li class="cat-item cat-item-8"><a href="http://noops.me/?cat=8" title="查看 运维工具 下的所有文章">运维工具</a>
</li>
		</ul>
</section><section class="widget-container widget_tag_cloud first odd"><h1 class="widget-title">文章标签</h1><div class="tagcloud"><a href="http://noops.me/?tag=ansible" class="tag-link-97" title="2 个话题" style="font-size: 13.25pt;">ansible</a>
<a href="http://noops.me/?tag=backup" class="tag-link-23" title="1 个话题" style="font-size: 8pt;">backup</a>
<a href="http://noops.me/?tag=cdn-2" class="tag-link-42" title="1 个话题" style="font-size: 8pt;">cdn</a>
<a href="http://noops.me/?tag=chroot" class="tag-link-37" title="1 个话题" style="font-size: 8pt;">chroot</a>
<a href="http://noops.me/?tag=cloudfoundry" class="tag-link-6" title="3 个话题" style="font-size: 16.75pt;">cloudfoundry</a>
<a href="http://noops.me/?tag=compress" class="tag-link-24" title="1 个话题" style="font-size: 8pt;">compress</a>
<a href="http://noops.me/?tag=dba%e6%8b%9b%e8%81%98" class="tag-link-51" title="1 个话题" style="font-size: 8pt;">DBA招聘</a>
<a href="http://noops.me/?tag=dns" class="tag-link-44" title="1 个话题" style="font-size: 8pt;">dns</a>
<a href="http://noops.me/?tag=docker" class="tag-link-19" title="2 个话题" style="font-size: 13.25pt;">docker</a>
<a href="http://noops.me/?tag=edns" class="tag-link-43" title="1 个话题" style="font-size: 8pt;">edns</a>
<a href="http://noops.me/?tag=edns-client-subnet" class="tag-link-41" title="1 个话题" style="font-size: 8pt;">edns-client-subnet</a>
<a href="http://noops.me/?tag=encrypt" class="tag-link-25" title="1 个话题" style="font-size: 8pt;">encrypt</a>
<a href="http://noops.me/?tag=eventmachine" class="tag-link-7" title="1 个话题" style="font-size: 8pt;">eventmachine</a>
<a href="http://noops.me/?tag=filetail" class="tag-link-32" title="1 个话题" style="font-size: 8pt;">File::Tail</a>
<a href="http://noops.me/?tag=gist" class="tag-link-46" title="1 个话题" style="font-size: 8pt;">gist</a>
<a href="http://noops.me/?tag=git" class="tag-link-45" title="1 个话题" style="font-size: 8pt;">git</a>
<a href="http://noops.me/?tag=github-markdown-flaverd" class="tag-link-47" title="1 个话题" style="font-size: 8pt;">github markdown flaverd</a>
<a href="http://noops.me/?tag=google_hacking" class="tag-link-34" title="1 个话题" style="font-size: 8pt;">Google_Hacking</a>
<a href="http://noops.me/?tag=haproxy" class="tag-link-29" title="1 个话题" style="font-size: 8pt;">haproxy</a>
<a href="http://noops.me/?tag=innodb" class="tag-link-22" title="1 个话题" style="font-size: 8pt;">innodb</a>
<a href="http://noops.me/?tag=lxc" class="tag-link-16" title="1 个话题" style="font-size: 8pt;">lxc</a>
<a href="http://noops.me/?tag=misaka" class="tag-link-48" title="1 个话题" style="font-size: 8pt;">misaka</a>
<a href="http://noops.me/?tag=mysql" class="tag-link-20" title="2 个话题" style="font-size: 13.25pt;">mysql</a>
<a href="http://noops.me/?tag=noops" class="tag-link-57" title="2 个话题" style="font-size: 13.25pt;">noops</a>
<a href="http://noops.me/?tag=openssh" class="tag-link-38" title="1 个话题" style="font-size: 8pt;">openssh</a>
<a href="http://noops.me/?tag=optimize" class="tag-link-30" title="1 个话题" style="font-size: 8pt;">optimize</a>
<a href="http://noops.me/?tag=pcap" class="tag-link-36" title="1 个话题" style="font-size: 8pt;">pcap</a>
<a href="http://noops.me/?tag=puppet" class="tag-link-39" title="1 个话题" style="font-size: 8pt;">puppet</a>
<a href="http://noops.me/?tag=pygments" class="tag-link-49" title="1 个话题" style="font-size: 8pt;">pygments</a>
<a href="http://noops.me/?tag=python" class="tag-link-10" title="1 个话题" style="font-size: 8pt;">python</a>
<a href="http://noops.me/?tag=python%e7%a0%94%e5%8f%91%e5%b7%a5%e7%a8%8b%e5%b8%88%e6%8b%9b%e8%81%98" class="tag-link-52" title="1 个话题" style="font-size: 8pt;">python研发工程师招聘</a>
<a href="http://noops.me/?tag=ruby" class="tag-link-2" title="4 个话题" style="font-size: 19.6667pt;">ruby</a>
<a href="http://noops.me/?tag=shell" class="tag-link-4" title="1 个话题" style="font-size: 8pt;">shell</a>
<a href="http://noops.me/?tag=signal" class="tag-link-5" title="1 个话题" style="font-size: 8pt;">signal</a>
<a href="http://noops.me/?tag=websocket" class="tag-link-31" title="1 个话题" style="font-size: 8pt;">websocket</a>
<a href="http://noops.me/?tag=xtrabackup" class="tag-link-21" title="1 个话题" style="font-size: 8pt;">xtrabackup</a>
<a href="http://noops.me/?tag=%e5%b0%8f%e7%b1%b3%e8%bf%90%e7%bb%b4" class="tag-link-50" title="3 个话题" style="font-size: 16.75pt;">小米运维</a>
<a href="http://noops.me/?tag=%e7%9b%91%e6%8e%a7" class="tag-link-110" title="2 个话题" style="font-size: 13.25pt;">监控</a>
<a href="http://noops.me/?tag=%e8%99%9a%e6%8b%9f%e5%8c%96" class="tag-link-17" title="1 个话题" style="font-size: 8pt;">虚拟化</a>
<a href="http://noops.me/?tag=%e8%b4%9f%e8%bd%bd%e5%9d%87%e8%a1%a1-%e6%b5%81%e9%87%8f%e7%ae%a1%e7%90%86-zxtm-zeus-4-7%e4%ba%a4%e6%8d%a2%e6%9c%ba" class="tag-link-40" title="1 个话题" style="font-size: 8pt;">负载均衡 流量管理 ZXTM ZEUS 4-7交换机</a>
<a href="http://noops.me/?tag=%e8%b5%84%e6%ba%90%e9%9a%94%e7%a6%bb" class="tag-link-15" title="1 个话题" style="font-size: 8pt;">资源隔离</a>
<a href="http://noops.me/?tag=%e8%bf%90%e7%bb%b4%e5%b9%b3%e5%8f%b0" class="tag-link-33" title="2 个话题" style="font-size: 13.25pt;">运维平台</a>
<a href="http://noops.me/?tag=%e8%bf%90%e7%bb%b4%e6%a0%a1%e6%8b%9b%e7%ac%94%e8%af%95%e9%a2%98" class="tag-link-83" title="2 个话题" style="font-size: 13.25pt;">运维校招笔试题</a>
<a href="http://noops.me/?tag=%e8%bf%90%e7%bb%b4%e8%87%aa%e5%8a%a8%e5%8c%96" class="tag-link-58" title="5 个话题" style="font-size: 22pt;">运维自动化</a>
<a href="http://noops.me/?tag=%e8%bf%9b%e7%a8%8b%e7%9b%91%e6%8e%a7" class="tag-link-14" title="1 个话题" style="font-size: 8pt;">进程监控</a></div>
</section><section class="widget-container widget_links even"><h1 class="widget-title">team</h1>
	<ul class="xoxo blogroll">
<li><a href="http://laiwei.net/" target="_blank">laiwei</a></li>
<li><a href="http://www.yubo.org/">yubo</a></li>

	</ul>
</section>
<section class="widget-container widget_links odd"><h1 class="widget-title">tech</h1>
	<ul class="xoxo blogroll">
<li><a href="http://blog.hellosa.org/" target="_blank">hellosa</a></li>
<li><a href="http://www.himysql.com/" target="_blank">himysql</a></li>
<li><a href="http://open-falcon.com/" target="_blank">Open-Falcon|互联网企业级监控系统</a></li>
<li><a href="http://chenlinux.com/" title="三斗室" target="_blank">三斗室</a></li>
<li><a href="http://www.baidu-ops.com/" target="_blank">百度运维部</a></li>
<li><a href="http://linuxtone.org/" rel="friend" title="运维专家网论坛" target="_blank">运维专家网</a></li>
<li><a href="http://www.yunweipai.com/" target="_blank">运维派</a></li>

	</ul>
</section>
<section class="widget-container widget_meta first even"><h1 class="widget-title">功能</h1>			<ul>
			<li><a href="http://noops.me/wp-login.php?action=register">注册</a></li>			<li><a href="http://noops.me/wp-login.php">登录</a></li>
			<li><a href="http://noops.me/?feed=rss2" title="使用 RSS 2.0 订阅本站点内容">文章 <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="http://noops.me/?feed=comments-rss2" title="使用 RSS 订阅本站点的所有文章的近期评论">评论 <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="http://cn.wordpress.org/" title="基于 WordPress，一个优美、先进的个人信息发布平台。">WordPress.org</a></li>
						</ul>
</section></aside><span class="toggle-sidebar"></span></div>
</div>

    <footer>
        <p id="copyright">© NoOps, 2016. All Rights Reserved &nbsp;
        </p>
    </footer>

    


</body>
</html>
