<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta content="authenticity_token" name="csrf-param">
<meta content="4C11/ZgOYG6tu33CwWFzSdlSeprC4cudc4IytiVwXgo=" name="csrf-token">
    <title>
            使用graphviz画数据结构 - 推酷
   </title>
    <meta name="description" content="使用graphviz画数据结构">
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
  <link href="http://static0.tuicool.com/images/icon114.png" rel="Bookmark">
  <link rel="apple-touch-icon" sizes="57x57" href="http://static1.tuicool.com/images/icon57.png"> 
  <link rel="apple-touch-icon" sizes="72x72" href="http://static2.tuicool.com/images/icon72.png">  
  <link rel="apple-touch-icon" sizes="114x114" href="http://static0.tuicool.com/images/icon114.png">    
  <link rel="apple-touch-icon" sizes="144x144" href="http://static1.tuicool.com/images/icon144.png">  
  
  
  

  <!--[if IE 7]>
  <link rel="stylesheet" href="http://assets.tuicool.com/assets/font-awesome-ie7.min.css">
  <![endif]--> 
    
  
  



<link rel="stylesheet" type="text/css" href="index.css" media="all">
</head>
<body class="  pace-done"><div class="pace  pace-inactive"><div data-progress="99" data-progress-text="100%" style="transform: translate3d(100%, 0px, 0px);" class="pace-progress">
  <div class="pace-progress-inner"></div>
</div>
<div class="pace-activity"></div></div>
  
  <div id="header" class="navbar-fixed-top">
    <div class="container">
      <div class="navbar">
        <div class="navbar-inner">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"> 
            <span class="icon-bar"></span> 
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span> 
          </a>
          <a href="http://www.tuicool.com/" class="brand">推酷</a>        
        <nav class="nav-collapse collapse">
            <ul class="nav navbar primary-nav">                            
              <li class="active">
                <a href="http://www.tuicool.com/ah">
                  文章
                </a>
              </li>              
              <li class="">
                <a href="http://www.tuicool.com/sites/hot">
                  站点
                </a>
              </li>
              <li class="">
                <a href="http://www.tuicool.com/topics">
                  主题
                </a>
              </li>
              <li class="">
                <a href="http://course.tuicool.com/">
                  公开课
                </a>
              </li>
              <li class="">
                <a href="http://huodong.tuicool.com/">
                  活动
                </a>
              </li>
              <li class="">
                <a href="http://www.tuicool.com/mobile">
                  客户端
                    <sup style="font-size: 0.8em; color: rgb(22, 160, 133);">荐</sup>
                </a>
              </li>
              <li class="dropdown  ">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">周刊 <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="http://www.tuicool.com/mags">编程狂人</a></li>
                  <li><a href="http://www.tuicool.com/mags/design">设计匠艺</a></li> 
                  <li><a href="http://www.tuicool.com/mags/startup">创业周刊</a></li> 
                  <li><a href="http://www.tuicool.com/mags/tech">科技周刊</a></li>      
                  <li><a href="http://www.tuicool.com/mags/guru">Guru Weekly</a></li> 
                  <li><a href="http://www.tuicool.com/articles/weekly">一周拾遗</a></li>                  
                </ul>
              </li>
              
              </ul>
            <form class="navbar-search pull-left" action="http://www.tuicool.com/search">
              <input class="search-query span2" name="kw" placeholder="搜索" type="text">
            </form>
            <ul class="nav pull-right">
                <li><a href="http://www.tuicool.com/login">登录</a></li>
            </ul>
          </nav>
        </div>
      </div>
  </div>   
</div>
  <div id="flash_container" class="noPrint">    
  </div>
  
  <div class="container-fluid">  
      
<div class="row-fluid article_row_fluid">
    <div class="span8 contant article_detail_bg">
        <h1>使用graphviz画数据结构</h1>
        <div class="article_meta">
            <div style="margin-bottom: 5px;">
            <span class="timestamp">时间&nbsp;2011-06-15 07:52:08
            </span>
            <span class="from">
                <i class="icon-globe"></i>
                    <a class="cut cut28 from" href="http://www.tuicool.com/sites/7VvUfu" target="_blank">Emacs中文网
                    </a>
            </span>
            </div>
            <div class="source">
                <i style="float: left;">原文</i>&nbsp; 
                <a class="cut cut70" href="http://emacser.com/emacs_graphviz_ds.htm?utm_source=tuicool&amp;utm_medium=referral" style="display: inline-block;">http://emacser.com/emacs_graphviz_ds.htm</a>
            </div>
            <div>
                <span>主题</span>
                <a href="http://www.tuicool.com/topics/11000082" target="_blank">
                    <span class="new-label">数据结构</span>
                </a>
                <a href="http://www.tuicool.com/topics/11200024" target="_blank">
                    <span class="new-label">Emacs</span>
                </a>
                <a href="http://www.tuicool.com/topics/11010001" target="_blank">
                    <span class="new-label">C++</span>
                </a>
            </div>
        </div>
        <div class="article_body" id="nei">
            <div>
  <p>
    <span style="color: rgb(0, 0, 255);">作者:</span>
    <a href="http://blog.163.com/vic_kk/blog/static/49470524201010180715177/" target="_blank">
      <span style="color: rgb(0, 0, 255);">
        <b>tubo</b>
      </span>
    </a>
  </p>
  <p>
    今天下午用了些时间写了个小的函数，该函数配合 autoinsert + graphviz-dot-mode ，可以很方便的将 C 语言中指定的 struct 结构画出来。这样，画了多个数据结构之后，再手动添加几条线， 数据结构之间的关系就一目了然了。
  </p>
  <div>
    <div>
      <ul>
        <li>
          <a href="http://emacser.com/emacs_graphviz_ds.htm#sec-1">1 Graphviz &amp; graphviz-dot-mode</a>
          <ul>
            <li>
              <a href="http://emacser.com/emacs_graphviz_ds.htm#sec-1_1">1.1 What is Graphviz?</a>
            </li>
            <li>
              <a href="http://emacser.com/emacs_graphviz_ds.htm#sec-1_2">1.2 Graphviz 的安装</a>
            </li>
            <li>
              <a href="http://emacser.com/emacs_graphviz_ds.htm#sec-1_3">1.3 Graphviz 的使用</a>
            </li>
            <li>
              <a href="http://emacser.com/emacs_graphviz_ds.htm#sec-1_4">1.4 graphviz-dot-mode</a>
            </li>
          </ul>
        </li>
        <li>
          <a href="http://emacser.com/emacs_graphviz_ds.htm#sec-2">2 小函数登场</a>
          <ul>
            <li>
              <a href="http://emacser.com/emacs_graphviz_ds.htm#sec-2_1">2.1 elisp 代码</a>
            </li>
            <li>
              <a href="http://emacser.com/emacs_graphviz_ds.htm#sec-2_2">2.2 使用方法</a>
            </li>
          </ul>
        </li>
        <li>
          <a href="http://emacser.com/emacs_graphviz_ds.htm#sec-3">3 autoinert 配置</a>
        </li>
        <li>
          <a href="http://emacser.com/emacs_graphviz_ds.htm#sec-4">4 用法示例</a>
        </li>
        <li>
          <a href="http://emacser.com/emacs_graphviz_ds.htm#sec-5">5 后记</a>
        </li>
      </ul>
    </div>
  </div>
  <div>
    <h3>
      <span>1</span>
      Graphviz &amp; graphviz-dot-mode
    </h3>
    <div>
      <h4>
        <span>1.1</span>
        What is Graphviz?
      </h4>
      <div>
        <p>简单的说， graphviz 是一个开源的自动图形绘制工具, 可以很方便的可视化结构信息，把抽象的图和网络用几何的方式表现出来。</p>
        <p>Graphviz is open source graph visualization software. Graph visualization is a way of representing structural information as diagrams of abstract graphs and networks. It has important applications in networking, bioinformatics, software engineering, database and web design, machine learning, and in visual interfaces for other technical domains.</p>
        <p>
          更多信息请参考其主页：
          <a href="http://www.graphviz.org/" target="_blank">http://www.graphviz.org/</a>
        </p>
      </div>
    </div>
    <div>
      <h4>
        <span>1.2</span>
        Graphviz 的安装
      </h4>
      <div>
        <p>
          Linux 下几乎所有的发行版都有这个工具，如果没有默认安装的话，也可以通过发行版自带的软件管理工具来或者去其下载页面上下载相应的二进制包或者源码包。同时该软件也提供了 windows 下的安装文件，参见：
          <a href="http://www.graphviz.org/Download..php" target="_blank">http://www.graphviz.org/Download..php</a>
        </p>
        <p>gentoo 下安装 graphviz ， 一如既往的简单：</p>
        <div>
          <span>
            <sup>
              <a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" target="_blank" title="WP-CodeBox HowTo?">
                <span style="color: rgb(153, 204, 0);">?</span>
              </a>
            </sup>
          </span>
          <span>
            <a href="http://emacser.com/javascript:;">View Code</a>
            BASH
          </span>
        </div>
        <div>
          <table>
            <tbody><tr>
              <td>
                <pre class="prettyprint undefined">emerge <span style="color: rgb(102, 0, 51);">-av</span> graphviz</pre>
              </td>
            </tr>
          </tbody></table>
        </div>
      </div>
    </div>
    <div>
      <h4>
        <span>1.3</span>
        Graphviz 的使用
      </h4>
      <div>
        <p>
          这个话题比较大，离本文的目的有点偏，而且有网上也很多的教程，所以不多言了，可以参考这里：
          <a href="http://www.google.com/search?hl=en&amp;source=hp&amp;biw=1278&amp;bih=898&amp;q=graphviz+%25E6%2595%2599%25E7%25A8%258B" target="_blank">http://www.google.com/search?hl=en&amp;source=hp&amp;biw=1278&amp;bih=898&amp;q=graphviz+%E6%95%99%E7%A8%8B</a>
        </p>
      </div>
    </div>
    <div>
      <h4>
        <span>1.4</span>
        graphviz-dot-mode
      </h4>
      <div>
        <p>用过 Emacs 的人一看就知道：这肯定是为 emacs 写的、编写 dot 文件（graphviz 的输入文件）的模式，提供了文件的编译、预览、快速注释等等的相应功能。gentoo 下有现成的 ebuild ， 只要 emerge 一下就可以了：</p>
        <div>
          <span>
            <sup>
              <a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" target="_blank" title="WP-CodeBox HowTo?">
                <span style="color: rgb(153, 204, 0);">?</span>
              </a>
            </sup>
          </span>
          <span>
            <a href="http://emacser.com/javascript:;">View Code</a>
            C
          </span>
        </div>
        <div>
          <table>
            <tbody><tr>
              <td>
                <pre class="prettyprint undefined">emerge <span style="color: rgb(51, 153, 51);">-</span>av graphivz<span style="color: rgb(51, 153, 51);">-</span>dot<span style="color: rgb(51, 153, 51);">-</span>mode</pre>
              </td>
            </tr>
          </tbody></table>
        </div>
        <p>
          如果是其他发行版的话，从其
          <a href="http://users.skynet.be/ppareit/projects/graphviz-dot-mode/graphviz-dot-mode.html" target="_blank">主页</a>
          上下载该文件，然后放到 emacs 的 load-path 下即可。下面是一个简单的设置：
        </p>
        <div>
          <span>
            <sup>
              <a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" target="_blank" title="WP-CodeBox HowTo?">
                <span style="color: rgb(153, 204, 0);">?</span>
              </a>
            </sup>
          </span>
          <span>
            <a href="http://emacser.com/javascript:;">View Code</a>
            LISP
          </span>
        </div>
        <div>
          <table>
            <tbody><tr>
              <td>
                <pre class="prettyprint xml"><span style="color: rgb(102, 204, 102);">(</span>load <span style="color: rgb(255, 0, 0);">"graphviz-dot-mode.el"</span> <span style="color: rgb(177, 177, 0);">nil</span> t t<span style="color: rgb(102, 204, 102);">)</span>
&nbsp;
<span style="color: rgb(102, 204, 102);">(</span>add-hook 'find-file-hook <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(177, 177, 0);">lambda</span><span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(102, 204, 102);">)</span>
                            <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(177, 177, 0);">if</span> <span style="color: rgb(102, 204, 102);">(</span>string<span style="color: rgb(102, 204, 102);">=</span> <span style="color: rgb(255, 0, 0);">"dot"</span> <span style="color: rgb(102, 204, 102);">(</span>file-name-extension
                                                buffer-file-<span style="color: rgb(177, 177, 0);">name</span><span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span>
                                <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(177, 177, 0);">progn</span>
                                  <span style="color: rgb(102, 204, 102);">(</span>message <span style="color: rgb(255, 0, 0);">"Enabling Setings for dot-mode"</span><span style="color: rgb(102, 204, 102);">)</span>
                                  <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(177, 177, 0);">setq</span> fill-column <span style="color: rgb(204, 102, 204);">1000</span><span style="color: rgb(102, 204, 102);">)</span>
                                  <span style="color: rgb(102, 204, 102);">(</span>base-auto-pair<span style="color: rgb(102, 204, 102);">)</span>
                                  <span style="color: rgb(102, 204, 102);">(</span>local-set-key <span style="color: rgb(102, 204, 102);">(</span>kbd <span style="color: rgb(255, 0, 0);">"<span class="tag">&lt;<span class="title">C-f6</span>&gt;</span>"</span><span style="color: rgb(102, 204, 102);">)</span> 'compile<span style="color: rgb(102, 204, 102);">)</span>
                                  <span style="color: rgb(102, 204, 102);">)</span>
                              <span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span></pre>
              </td>
            </tr>
          </tbody></table>
        </div>
        <p>graphviz-mode 为编辑 dot 文件提供了下面的快捷键：</p>
        <ul>
          <li>
            <b>C-cc</b>
            快速编译
          </li>
          <li>
            <b>C-cp</b>
            预览图像
          </li>
          <li>
            <b>M-;</b>
            注释或者取消注释
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div>
    <h3>
      <span>2</span>
      小函数登场
    </h3>
    <div>
      <h4>
        <span>2.1</span>
        elisp 代码
      </h4>
      <div>
        <p>
          主要思想是解析 buffer 中选中的文本，通过正则表达式来匹配，从中找到 struct name 以及其中的各个 fields， 最后根据 dot 语法将其组成一个 subgraph。其实应该有更好的方法（比如通过 CEDET 的 Semantic 解析结果来做），但对 CEDET 的代码实在不熟，所以现在就只能这样了。
          <br>
          代码如下：
        </p>
        <div>
          <span>
            <sup>
              <a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" target="_blank" title="WP-CodeBox HowTo?">
                <span style="color: rgb(153, 204, 0);">?</span>
              </a>
            </sup>
          </span>
          <span>
            <a href="http://emacser.com/javascript:;">View Code</a>
            LISP
          </span>
        </div>
        <div>
          <table>
            <tbody><tr>
              <td>
                <pre class="prettyprint php"><span style="color: rgb(128, 128, 128); font-style: italic;">;; <span class="function"><span class="keyword">Function</span> <span class="title">used</span> <span class="title">to</span> <span class="title">add</span> <span class="title">fields</span> <span class="title">of</span> <span class="title">struct</span> <span class="title">into</span> <span class="title">a</span> <span class="title">dot</span> <span class="title">file</span> <span class="params">(for Graphviz)</span>.</span></span><span class="function">
<span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">defconst yyc/dot-head <span style="color: rgb(255, 0, 0);"><span class="string">"subgraph cluster_%s {
    node [shape=record fontsize=12 fontname=Courier style=filled];
    color = lightgray;
    style=filled;
    label = <span style="color: rgb(0, 0, 153); font-weight: bold;">\"</span>Struct %s<span style="color: rgb(0, 0, 153); font-weight: bold;">\"</span>;
    edge[color=<span style="color: rgb(0, 0, 153); font-weight: bold;">\"</span>#2e3436<span style="color: rgb(0, 0, 153); font-weight: bold;">\"</span>];"</span></span>
  <span style="color: rgb(255, 0, 0);"><span class="string">"Header part of dot file."</span></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
<span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">defconst yyc/dot-tail <span style="color: rgb(255, 0, 0);"><span class="string">"
}"</span></span>
  <span style="color: rgb(255, 0, 0);"><span class="string">"Tail part of dot"</span></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
<span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">defconst yyc/dot-node-head
  <span style="color: rgb(255, 0, 0);"><span class="string">"
        node_%s[shape=record label=<span style="color: rgb(0, 0, 153); font-weight: bold;">\"</span>&lt;f0&gt;*** STRUCT %s ***|<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>"</span></span>
  <span style="color: rgb(255, 0, 0);"><span class="string">"Format of node."</span></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
<span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">defconst yyc/dot-node-tail <span style="color: rgb(255, 0, 0);"><span class="string">"
<span style="color: rgb(0, 0, 153); font-weight: bold;">\"</span>];"</span></span>
  <span style="color: rgb(255, 0, 0);"><span class="string">"Format of node."</span></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
&nbsp;
<span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">defconst r_attr_str <span style="color: rgb(255, 0, 0);"><span class="string">"[ <span style="color: rgb(0, 0, 153); font-weight: bold;">\t</span>]+<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>(.*+<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>)[ <span style="color: rgb(0, 0, 153); font-weight: bold;">\t</span>]+<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>(.*<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>)?;"</span></span>
  <span style="color: rgb(255, 0, 0);"><span class="string">"Regular expression for matching struct fields."</span></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
&nbsp;
<span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">defconst r_name <span style="color: rgb(255, 0, 0);"><span class="string">"<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>_&lt;<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>(typedef[ <span style="color: rgb(0, 0, 153); font-weight: bold;">\t</span>]+<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>)?struct[ <span style="color: rgb(0, 0, 153); font-weight: bold;">\t</span>]+<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>(.*<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>)?[ <span style="color: rgb(0, 0, 153); font-weight: bold;">\t</span>]*{"</span></span>
  <span style="color: rgb(255, 0, 0);"><span class="string">"Regular expression for mating struct name"</span></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
&nbsp;
<span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">defconst attr_str <span style="color: rgb(255, 0, 0);"><span class="string">"
&lt;f%d&gt;%s %s<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>l|<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>"</span></span> <span style="color: rgb(255, 0, 0);"><span class="string">"nil"</span></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
&nbsp;
<span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params"><span style="color: rgb(177, 177, 0);">defun</span> yyc/datastruct-to-dot <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">start end<span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
  <span style="color: rgb(255, 0, 0);"><span class="string">"generate c++ function definition and insert it into `buffer'"</span></span>
  <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">interactive <span style="color: rgb(255, 0, 0);"><span class="string">"rp"</span></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
  <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params"><span style="color: rgb(177, 177, 0);">setq</span> var-defination <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">buffer-substring-no-properties start end<span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
  <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params"><span style="color: rgb(177, 177, 0);">let</span>* <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params"><span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">tmp_str <span style="color: rgb(255, 0, 0);"><span class="string">""</span></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
         <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">var-<span style="color: rgb(177, 177, 0);">name</span> <span style="color: rgb(255, 0, 0);"><span class="string">""</span></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
         <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">var-type <span style="color: rgb(255, 0, 0);"><span class="string">""</span></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
         <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">counter <span style="color: rgb(204, 102, 204);"><span class="number">0</span></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
         <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">struct-<span style="color: rgb(177, 177, 0);">name</span> <span style="color: rgb(255, 0, 0);"><span class="string">""</span></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
         <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">header-str <span style="color: rgb(255, 0, 0);"><span class="string">""</span></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
         <span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
    <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params"><span style="color: rgb(177, 177, 0);">defun</span> iter <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">pos<span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
      <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params"><span style="color: rgb(177, 177, 0);">setq</span> counter <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">+ counter <span style="color: rgb(204, 102, 204);"><span class="number">1</span></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
      <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">message <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">format <span style="color: rgb(255, 0, 0);"><span class="string">"Counter: %d, pos: %d"</span></span>
                       counter pos<span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
      <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params"><span style="color: rgb(177, 177, 0);">if</span> <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">string-match r_name var-defination pos<span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
          <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params"><span style="color: rgb(177, 177, 0);">progn</span>
            <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">message <span style="color: rgb(255, 0, 0);"><span class="string">"A"</span></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
            <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params"><span style="color: rgb(177, 177, 0);">setq</span> struct-<span style="color: rgb(177, 177, 0);">name</span>
                  <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">match-string <span style="color: rgb(204, 102, 204);"><span class="number">2</span></span> var-defination<span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
            <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params"><span style="color: rgb(177, 177, 0);">setq</span> header-str
                  <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">format yyc/dot-head struct-<span style="color: rgb(177, 177, 0);">name</span> struct-<span style="color: rgb(177, 177, 0);">name</span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
            <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params"><span style="color: rgb(177, 177, 0);">setq</span> tmp_str
                  <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">format yyc/dot-node-head struct-<span style="color: rgb(177, 177, 0);">name</span> struct-<span style="color: rgb(177, 177, 0);">name</span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
            <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">iter <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">match-end <span style="color: rgb(204, 102, 204);"><span class="number">0</span></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
        <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params"><span style="color: rgb(177, 177, 0);">if</span> <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">string-match r_attr_str var-defination pos<span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
            <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params"><span style="color: rgb(177, 177, 0);">progn</span>
              <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">message <span style="color: rgb(255, 0, 0);"><span class="string">"B"</span></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
              <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params"><span style="color: rgb(177, 177, 0);">setq</span> var-type
                    <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">match-string <span style="color: rgb(204, 102, 204);"><span class="number">1</span></span> var-defination<span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
              <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params"><span style="color: rgb(177, 177, 0);">setq</span> var-<span style="color: rgb(177, 177, 0);">name</span>
                    <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">match-string <span style="color: rgb(204, 102, 204);"><span class="number">2</span></span> var-defination<span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
              <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params"><span style="color: rgb(177, 177, 0);">setq</span> tmp_str
                    <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">concat tmp_str
                            <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">format attr_str counter var-type var-<span style="color: rgb(177, 177, 0);">name</span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
              <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">iter <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">match-end <span style="color: rgb(204, 102, 204);"><span class="number">0</span></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
          <span style="color: rgb(177, 177, 0);">nil</span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
    <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">save-excursion
      <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">iter <span style="color: rgb(204, 102, 204);"><span class="number">0</span></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
      <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">set-buffer <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">get-buffer-create <span style="color: rgb(255, 0, 0);"><span class="string">"tmp.dot"</span></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
      <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">graphviz-dot-mode<span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
      <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params"><span style="color: rgb(177, 177, 0);">setq</span> pos <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">point-<span style="color: rgb(177, 177, 0);">max</span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
      <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">insert  header-str tmp_str <span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
      <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">goto-char <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">point-<span style="color: rgb(177, 177, 0);">max</span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
      <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">delete-char -<span style="color: rgb(204, 102, 204);"><span class="number">1</span></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
      <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">insert <span style="color: rgb(255, 0, 0);"><span class="string">"&lt;f999&gt;<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>"</span></span>yyc/dot-node-tail yyc/dot-tail<span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
      <span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
    <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params"><span style="color: rgb(177, 177, 0);">if</span> <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">one-window-p<span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
        <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">split-window-vertically<span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
    <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">switch-to-buffer-other-window <span style="color: rgb(255, 0, 0);"><span class="string">"tmp.dot"</span></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
    <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">goto-char <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">point-<span style="color: rgb(177, 177, 0);">min</span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
    <span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
  <span style="color: rgb(102, 204, 102);"><span class="params">(</span></span><span class="params">message <span style="color: rgb(255, 0, 0);"><span class="string">"Finished, please see *tmp.dot* buffer."</span></span><span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span>
  <span style="color: rgb(102, 204, 102);">)</span></span><span style="color: rgb(102, 204, 102);"></span></span><span style="color: rgb(102, 204, 102);"></span></pre>
              </td>
            </tr>
          </tbody></table>
        </div>
      </div>
    </div>
    <div>
      <h4>
        <span>2.2</span>
        使用方法
      </h4>
      <div>
        <p>用起来很简单：找到一个 C 代码，标记整个 struct 定义，然后M-x 输入： yyc/datastruct-to-dot 即可。命令执行完毕后，会打开一个新的 tmp.dot buffer，其中包含了用于绘制该 struct 的代码。前面也提到了，这生成的仅仅是个 subgraph，需要将这个 subgraph 添加到真正的 graph 下，才能生成图像。我通过 autoinsert 来自动创建用于放置 subgraph 的 graph 。</p>
      </div>
    </div>
  </div>
  <div>
    <h3>
      <span>3</span>
      autoinert 配置
    </h3>
    <div>
      <p>auto-insert 是 Emacs 自带的功能，稍加配置即可使用：</p>
      <div>
        <span>
          <sup>
            <a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" target="_blank" title="WP-CodeBox HowTo?">
              <span style="color: rgb(153, 204, 0);">?</span>
            </a>
          </sup>
        </span>
        <span>
          <a href="http://emacser.com/javascript:;">View Code</a>
          LISP
        </span>
      </div>
      <div>
        <table>
          <tbody><tr>
            <td>
              <pre class="prettyprint perl"><span style="color: rgb(128, 128, 128); font-style: italic;">;; <span class="variable">**</span><span class="variable">**</span><span class="variable">**</span><span class="variable">**</span><span class="variable">**</span><span class="variable">**</span><span class="variable">**</span> Autoinsert templates <span class="variable">**</span><span class="variable">**</span><span class="variable">**</span><span class="variable">**</span><span class="variable">**</span><span class="variable">**</span><span class="variable">**</span><span class="variable">**</span>*</span>
<span style="color: rgb(102, 204, 102);">(</span><span class="keyword">require</span> <span class="string">'autoinsert<span style="color: rgb(102, 204, 102);">)</span>
<span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(177, 177, 0);">setq</span> auto-insert-mode t<span style="color: rgb(102, 204, 102);">)</span>  <span style="color: rgb(128, 128, 128); font-style: italic;">;;; Adds hook to find-files-hook</span>
<span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(177, 177, 0);">setq</span> auto-insert-directory <span style="color: rgb(255, 0, 0);">"~/.emacs.d/templates/auto-insert/"</span><span style="color: rgb(102, 204, 102);">)</span>
<span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(177, 177, 0);">setq</span> auto-insert '</span>other<span style="color: rgb(102, 204, 102);">)</span>
<span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(177, 177, 0);">setq</span> auto-insert-query <span style="color: rgb(177, 177, 0);">nil</span><span style="color: rgb(102, 204, 102);">)</span>
&nbsp;
<span style="color: rgb(128, 128, 128); font-style: italic;">;; auto-insert stuff</span>
<span style="color: rgb(102, 204, 102);">(</span>add-hook <span class="string">'find-file-hooks '</span>auto-insert<span style="color: rgb(102, 204, 102);">)</span>
<span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(177, 177, 0);">setq</span> auto-insert-alist
      <span class="string">'<span style="color: rgb(102, 204, 102);">(</span>
        <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(255, 0, 0);">"<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>.cpp$"</span> <span style="color: rgb(102, 204, 102);">.</span> <span style="color: rgb(102, 204, 102);">[</span><span style="color: rgb(255, 0, 0);">"insert.cpp"</span> auto-update-c-source-file<span style="color: rgb(102, 204, 102);">]</span><span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(255, 0, 0);">"<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>.h$"</span>   <span style="color: rgb(102, 204, 102);">.</span> <span style="color: rgb(102, 204, 102);">[</span><span style="color: rgb(255, 0, 0);">"header.h"</span> auto-update-header-file<span style="color: rgb(102, 204, 102);">]</span><span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(255, 0, 0);">"<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>.c$"</span> <span style="color: rgb(102, 204, 102);">.</span> <span style="color: rgb(102, 204, 102);">[</span><span style="color: rgb(255, 0, 0);">"insert.c"</span> auto-update-c-source-file<span style="color: rgb(102, 204, 102);">]</span><span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(255, 0, 0);">"<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>.org$"</span> <span style="color: rgb(102, 204, 102);">.</span> <span style="color: rgb(102, 204, 102);">[</span><span style="color: rgb(255, 0, 0);">"insert.org"</span> auto-update-defaults<span style="color: rgb(102, 204, 102);">]</span><span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(255, 0, 0);">"<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>.sh$"</span> <span style="color: rgb(102, 204, 102);">.</span> <span style="color: rgb(102, 204, 102);">[</span><span style="color: rgb(255, 0, 0);">"insert.sh"</span> auto-update-defaults<span style="color: rgb(102, 204, 102);">]</span><span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(255, 0, 0);">"<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>.lisp$"</span> <span style="color: rgb(102, 204, 102);">.</span> <span style="color: rgb(102, 204, 102);">[</span><span style="color: rgb(255, 0, 0);">"insert.lisp"</span> auto-update-defaults<span style="color: rgb(102, 204, 102);">]</span><span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(255, 0, 0);">"<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>.el$"</span> <span style="color: rgb(102, 204, 102);">.</span> <span style="color: rgb(102, 204, 102);">[</span><span style="color: rgb(255, 0, 0);">"insert.el"</span> auto-update-defaults<span style="color: rgb(102, 204, 102);">]</span><span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(255, 0, 0);">"<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>.dot$"</span> <span style="color: rgb(102, 204, 102);">.</span> <span style="color: rgb(102, 204, 102);">[</span><span style="color: rgb(255, 0, 0);">"insert.dot"</span> auto-update-defaults<span style="color: rgb(102, 204, 102);">]</span><span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(255, 0, 0);">"<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>.erl$"</span> <span style="color: rgb(102, 204, 102);">.</span> <span style="color: rgb(102, 204, 102);">[</span><span style="color: rgb(255, 0, 0);">"insert.err"</span> auto-update-defaults<span style="color: rgb(102, 204, 102);">]</span><span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(255, 0, 0);">"<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>.py$"</span> <span style="color: rgb(102, 204, 102);">.</span> <span style="color: rgb(102, 204, 102);">[</span><span style="color: rgb(255, 0, 0);">"insert.py"</span> auto-update-defaults<span style="color: rgb(102, 204, 102);">]</span><span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(255, 0, 0);">"<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>.tex$"</span> <span style="color: rgb(102, 204, 102);">.</span> <span style="color: rgb(102, 204, 102);">[</span><span style="color: rgb(255, 0, 0);">"insert.tex"</span> auto-update-defaults<span style="color: rgb(102, 204, 102);">]</span><span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(255, 0, 0);">"<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>.html$"</span> <span style="color: rgb(102, 204, 102);">.</span> <span style="color: rgb(102, 204, 102);">[</span><span style="color: rgb(255, 0, 0);">"insert.html"</span> auto-update-defaults<span style="color: rgb(102, 204, 102);">]</span><span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(255, 0, 0);">"<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>.devhelp2$"</span> <span style="color: rgb(102, 204, 102);">.</span> <span style="color: rgb(102, 204, 102);">[</span><span style="color: rgb(255, 0, 0);">"insert.devhelp2"</span> auto-update-defaults<span style="color: rgb(102, 204, 102);">]</span><span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(255, 0, 0);">"<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>.ebuild$"</span> <span style="color: rgb(102, 204, 102);">.</span> <span style="color: rgb(102, 204, 102);">[</span><span style="color: rgb(255, 0, 0);">"insert.ebuild"</span> auto-update-defaults<span style="color: rgb(102, 204, 102);">]</span><span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(255, 0, 0);">"<span style="color: rgb(0, 0, 153); font-weight: bold;">\\</span>.sh$"</span> <span style="color: rgb(102, 204, 102);">.</span> <span style="color: rgb(102, 204, 102);">[</span><span style="color: rgb(255, 0, 0);">"insert.sh"</span> auto-update-defaults<span style="color: rgb(102, 204, 102);">]</span><span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(255, 0, 0);">"Doxyfile$"</span> <span style="color: rgb(102, 204, 102);">.</span> <span style="color: rgb(102, 204, 102);">[</span><span style="color: rgb(255, 0, 0);">"insert.doxyfile"</span> auto-update-defaults<span style="color: rgb(102, 204, 102);">]</span><span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span>
&nbsp;
<span style="color: rgb(128, 128, 128); font-style: italic;">;; function replaces the string '</span></span><span style="color: rgb(128, 128, 128); font-style: italic;"><span class="variable">@@</span><span class="variable">@'</span> by the current file</span>
<span style="color: rgb(128, 128, 128); font-style: italic;">;; name. You could <span class="keyword">use</span> a similar approach to insert name <span class="keyword">and</span> date into</span>
<span style="color: rgb(128, 128, 128); font-style: italic;">;; your file.</span>
<span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(177, 177, 0);">defun</span> auto-update-header-file <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(102, 204, 102);">)</span>
  <span style="color: rgb(102, 204, 102);">(</span>save-excursion
    <span style="color: rgb(102, 204, 102);">(</span><span class="keyword">while</span> <span style="color: rgb(102, 204, 102);">(</span>search-forward <span style="color: rgb(255, 0, 0);"><span class="string">"<span class="variable">@@</span><span class="variable">@"</span></span></span><span class="string"> <span style="color: rgb(177, 177, 0);">nil</span> t<span style="color: rgb(102, 204, 102);">)</span>
      <span style="color: rgb(102, 204, 102);">(</span>save-restriction
        <span style="color: rgb(102, 204, 102);">(</span>narrow-to-region <span style="color: rgb(102, 204, 102);">(</span>match-beginning <span style="color: rgb(204, 102, 204);">0</span><span style="color: rgb(102, 204, 102);">)</span> <span style="color: rgb(102, 204, 102);">(</span>match-end <span style="color: rgb(204, 102, 204);">0</span><span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">(</span>replace-match <span style="color: rgb(102, 204, 102);">(</span>upcase <span style="color: rgb(102, 204, 102);">(</span>file-name-nondirectory buffer-file-<span style="color: rgb(177, 177, 0);">name</span><span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">(</span>subst-char-in-region <span style="color: rgb(102, 204, 102);">(</span>point-<span style="color: rgb(177, 177, 0);">min</span><span style="color: rgb(102, 204, 102);">)</span> <span style="color: rgb(102, 204, 102);">(</span>point-<span style="color: rgb(177, 177, 0);">max</span><span style="color: rgb(102, 204, 102);">)</span> ?<span style="color: rgb(102, 204, 102);">.</span> ?_<span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span>
    <span style="color: rgb(102, 204, 102);">)</span>
  <span style="color: rgb(102, 204, 102);">)</span>
&nbsp;
<span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(177, 177, 0);">defun</span> insert-today <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(102, 204, 102);">)</span>
  <span style="color: rgb(255, 0, 0);">"</span></span><span style="color: rgb(255, 0, 0);">Insert today<span class="string">'s date into buffer"</span></span><span class="string">
  <span style="color: rgb(102, 204, 102);">(</span>interactive<span style="color: rgb(102, 204, 102);">)</span>
  <span style="color: rgb(102, 204, 102);">(</span>insert <span style="color: rgb(102, 204, 102);">(</span>format-time-string <span style="color: rgb(255, 0, 0);">"%m-%e-%Y"</span> <span style="color: rgb(102, 204, 102);">(</span>current-time<span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span>
&nbsp;
<span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(177, 177, 0);">defun</span> auto-update-c-source-file <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(102, 204, 102);">)</span>
  <span style="color: rgb(102, 204, 102);">(</span>save-excursion
    <span style="color: rgb(128, 128, 128); font-style: italic;">;; Replace HHHH with file name sans suffix</span>
    <span style="color: rgb(102, 204, 102);">(</span>while <span style="color: rgb(102, 204, 102);">(</span>search-forward <span style="color: rgb(255, 0, 0);">"HHHH"</span> <span style="color: rgb(177, 177, 0);">nil</span> t<span style="color: rgb(102, 204, 102);">)</span>
      <span style="color: rgb(102, 204, 102);">(</span>save-restriction
        <span style="color: rgb(102, 204, 102);">(</span>narrow-to-region <span style="color: rgb(102, 204, 102);">(</span>match-beginning <span style="color: rgb(204, 102, 204);">0</span><span style="color: rgb(102, 204, 102);">)</span> <span style="color: rgb(102, 204, 102);">(</span>match-end <span style="color: rgb(204, 102, 204);">0</span><span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">(</span>replace-match <span style="color: rgb(102, 204, 102);">(</span>concat <span style="color: rgb(102, 204, 102);">(</span>file-name-sans-extension <span style="color: rgb(102, 204, 102);">(</span>file-name-nondirectory buffer-file-<span style="color: rgb(177, 177, 0);">name</span><span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span> <span style="color: rgb(255, 0, 0);">".h"</span><span style="color: rgb(102, 204, 102);">)</span> t
                       <span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span>
    <span style="color: rgb(102, 204, 102);">)</span>
  <span style="color: rgb(102, 204, 102);">(</span>save-excursion
    <span style="color: rgb(128, 128, 128); font-style: italic;">;; Replace @@@ with file name</span>
    <span style="color: rgb(102, 204, 102);">(</span>while <span style="color: rgb(102, 204, 102);">(</span>search-forward <span style="color: rgb(255, 0, 0);">"@@@"</span> <span style="color: rgb(177, 177, 0);">nil</span> t<span style="color: rgb(102, 204, 102);">)</span>
      <span style="color: rgb(102, 204, 102);">(</span>save-restriction
        <span style="color: rgb(102, 204, 102);">(</span>narrow-to-region <span style="color: rgb(102, 204, 102);">(</span>match-beginning <span style="color: rgb(204, 102, 204);">0</span><span style="color: rgb(102, 204, 102);">)</span> <span style="color: rgb(102, 204, 102);">(</span>match-end <span style="color: rgb(204, 102, 204);">0</span><span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">(</span>replace-match <span style="color: rgb(102, 204, 102);">(</span>file-name-nondirectory buffer-file-<span style="color: rgb(177, 177, 0);">name</span><span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span>
    <span style="color: rgb(102, 204, 102);">)</span>
  <span style="color: rgb(102, 204, 102);">(</span>save-excursion
    <span style="color: rgb(128, 128, 128); font-style: italic;">;; replace DDDD with today'</span></span><span style="color: rgb(128, 128, 128); font-style: italic;"><span class="keyword">s</span> date</span>
    <span style="color: rgb(102, 204, 102);">(</span><span class="keyword">while</span> <span style="color: rgb(102, 204, 102);">(</span>search-forward <span style="color: rgb(255, 0, 0);"><span class="string">"DDDD"</span></span> <span style="color: rgb(177, 177, 0);">nil</span> t<span style="color: rgb(102, 204, 102);">)</span>
      <span style="color: rgb(102, 204, 102);">(</span>save-restriction
        <span style="color: rgb(102, 204, 102);">(</span>narrow-to-region <span style="color: rgb(102, 204, 102);">(</span>match-beginning <span style="color: rgb(204, 102, 204);"><span class="number">0</span></span><span style="color: rgb(102, 204, 102);">)</span> <span style="color: rgb(102, 204, 102);">(</span>match-end <span style="color: rgb(204, 102, 204);"><span class="number">0</span></span><span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">(</span>replace-match <span style="color: rgb(255, 0, 0);"><span class="string">""</span></span><span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">(</span>insert-today<span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span>
    <span style="color: rgb(102, 204, 102);">)</span>
  <span style="color: rgb(102, 204, 102);">)</span>
&nbsp;
<span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(177, 177, 0);">defun</span> auto-replace-file-<span style="color: rgb(177, 177, 0);">name</span> <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(102, 204, 102);">)</span>
  <span style="color: rgb(102, 204, 102);">(</span>save-excursion
    <span style="color: rgb(128, 128, 128); font-style: italic;">;; Replace <span class="variable">@@</span>@ with file name</span>
    <span style="color: rgb(102, 204, 102);">(</span><span class="keyword">while</span> <span style="color: rgb(102, 204, 102);">(</span>search-forward <span style="color: rgb(255, 0, 0);"><span class="string">"(&gt;&gt;FILE&lt;&lt;)"</span></span> <span style="color: rgb(177, 177, 0);">nil</span> t<span style="color: rgb(102, 204, 102);">)</span>
      <span style="color: rgb(102, 204, 102);">(</span>save-restriction
        <span style="color: rgb(102, 204, 102);">(</span>narrow-to-region <span style="color: rgb(102, 204, 102);">(</span>match-beginning <span style="color: rgb(204, 102, 204);"><span class="number">0</span></span><span style="color: rgb(102, 204, 102);">)</span> <span style="color: rgb(102, 204, 102);">(</span>match-end <span style="color: rgb(204, 102, 204);"><span class="number">0</span></span><span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">(</span>replace-match <span style="color: rgb(102, 204, 102);">(</span>file-name-nondirectory buffer-file-<span style="color: rgb(177, 177, 0);">name</span><span style="color: rgb(102, 204, 102);">)</span> t<span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span>
    <span style="color: rgb(102, 204, 102);">)</span>
  <span style="color: rgb(102, 204, 102);">)</span>
&nbsp;
<span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(177, 177, 0);">defun</span> auto-update-defaults <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(102, 204, 102);">)</span>
  <span style="color: rgb(102, 204, 102);">(</span>auto-replace-file-<span style="color: rgb(177, 177, 0);">name</span><span style="color: rgb(102, 204, 102);">)</span>
  <span style="color: rgb(102, 204, 102);">(</span>auto-replace-file-name-<span class="keyword">no</span>-ext<span style="color: rgb(102, 204, 102);">)</span>
  <span style="color: rgb(102, 204, 102);">(</span>auto-replace-date-<span class="keyword">time</span><span style="color: rgb(102, 204, 102);">)</span>
  <span style="color: rgb(102, 204, 102);">)</span>
&nbsp;
<span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(177, 177, 0);">defun</span> auto-replace-file-name-<span class="keyword">no</span>-ext <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(102, 204, 102);">)</span>
  <span style="color: rgb(102, 204, 102);">(</span>save-excursion
    <span style="color: rgb(128, 128, 128); font-style: italic;">;; Replace <span class="variable">@@</span>@ with file name</span>
    <span style="color: rgb(102, 204, 102);">(</span><span class="keyword">while</span> <span style="color: rgb(102, 204, 102);">(</span>search-forward <span style="color: rgb(255, 0, 0);"><span class="string">"(&gt;&gt;FILE_NO_EXT&lt;&lt;)"</span></span> <span style="color: rgb(177, 177, 0);">nil</span> t<span style="color: rgb(102, 204, 102);">)</span>
      <span style="color: rgb(102, 204, 102);">(</span>save-restriction
        <span style="color: rgb(102, 204, 102);">(</span>narrow-to-region <span style="color: rgb(102, 204, 102);">(</span>match-beginning <span style="color: rgb(204, 102, 204);"><span class="number">0</span></span><span style="color: rgb(102, 204, 102);">)</span> <span style="color: rgb(102, 204, 102);">(</span>match-end <span style="color: rgb(204, 102, 204);"><span class="number">0</span></span><span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">(</span>replace-match <span style="color: rgb(102, 204, 102);">(</span>file-name-sans-extension <span style="color: rgb(102, 204, 102);">(</span>file-name-nondirectory buffer-file-<span style="color: rgb(177, 177, 0);">name</span><span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span> t<span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span>
    <span style="color: rgb(102, 204, 102);">)</span>
  <span style="color: rgb(102, 204, 102);">)</span>
&nbsp;
<span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(177, 177, 0);">defun</span> auto-replace-date-<span class="keyword">time</span> <span style="color: rgb(102, 204, 102);">(</span><span style="color: rgb(102, 204, 102);">)</span>
  <span style="color: rgb(102, 204, 102);">(</span>save-excursion
    <span style="color: rgb(102, 204, 102);">(</span><span class="keyword">while</span> <span style="color: rgb(102, 204, 102);">(</span>search-forward <span style="color: rgb(255, 0, 0);"><span class="string">"(&gt;&gt;DATE&lt;&lt;)"</span></span> <span style="color: rgb(177, 177, 0);">nil</span> t<span style="color: rgb(102, 204, 102);">)</span>
      <span style="color: rgb(102, 204, 102);">(</span>save-restriction
        <span style="color: rgb(102, 204, 102);">(</span>narrow-to-region <span style="color: rgb(102, 204, 102);">(</span>match-beginning <span style="color: rgb(204, 102, 204);"><span class="number">0</span></span><span style="color: rgb(102, 204, 102);">)</span> <span style="color: rgb(102, 204, 102);">(</span>match-end <span style="color: rgb(204, 102, 204);"><span class="number">0</span></span><span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">(</span>replace-match <span style="color: rgb(255, 0, 0);"><span class="string">""</span></span> t<span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">(</span>insert-today<span style="color: rgb(102, 204, 102);">)</span>
        <span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span><span style="color: rgb(102, 204, 102);">)</span></pre>
            </td>
          </tr>
        </tbody></table>
      </div>
      <p>模板文件存放于 “~/.emacs.d/templates/auto-insert/” 中，其中， insert.dot 的内容如下：</p>
      <pre class="prettyprint xml">// $Id: (&gt;&gt;FILE<span class="tag">&lt;<span class="title">&lt;),</span> (&gt;</span>&gt;DATE<span class="tag">&lt;<span class="title">&lt;)
digraph</span> <span class="attribute">Name</span> {
    <span class="attribute">node</span> [<span class="attribute">shape</span>=<span class="value">record</span> <span class="attribute">fontsize</span>=<span class="value">12</span> <span class="attribute">fontname</span>=<span class="value">Courier</span> <span class="attribute">style</span>=<span class="value">filled];</span>
    <span class="attribute">edge</span>[<span class="attribute">color</span>=<span class="value">blue];</span>
    <span class="attribute">rankdir</span>=<span class="value">LR;</span>

// <span class="attribute">XXX:</span> <span class="attribute">place</span> <span class="attribute">to</span> <span class="attribute">put</span> <span class="attribute">subgraph</span>

}</span></pre>
    </div>
  </div>
  <div>
    <h3>
      <span>4</span>
      用法示例
    </h3>
    <div>
      <p>一个简单的使用示例，有如下步骤：</p>
      <ul>
        <li>
          <b>1:</b>
          打开一个 C 文件
          <br>
          <p>如内核代码中的 drivers/usb/storage/usb.h</p>
        </li>
        <li>
          <b>2:</b>
          打开一个 dot 文件(/tmp/usb.dot)
          <br>
          <p>auto-insert 会自动插入一些文件内容.</p>
        </li>
        <li>
          <b>3:</b>
          选中 struct us_data 的定义，并执行 yyc/datastruct-to-dot。
          <br>
          <p>执行完成后， us_data 的数据填写到了 tmp.dot 中，将该 buffer 中的所有内容 kill 掉，并 yank 到 usb.dot 中 XXX 这一行的下面。此时，保存 sub.dot ， 并按下快捷键 : C-cc ， 然后按下 Enter ， 就会自动编译。然后再按下 C-cp 就可以在另外一个 buffer 中预览它了。</p>
          <p>其实到这里，一个 C 语言的 struct 数据结构就已经被画出来了，后面的两个步骤，是为了介绍怎样将多个数据结构联系起来。</p>
        </li>
        <li>
          <b>4:</b>
          添加其他的 subgraph
          <br>
          <p>我们可以继续添加其他的 subgraph ， 例如 struct usb_ctrlrequest *cr ，以及 struct usb_sg_request， 并全部做为 subgraph 添加到 usb.dot 中。</p>
        </li>
        <li>
          <b>5:</b>
          为 subgraph 建立关联
          <br>
          <p>很简单，通过 “-&gt;” 画两条线就可以了。</p>
          <p>最后生成的文件如下：</p>
          <pre class="prettyprint xml">digraph USB {
    node [shape=record fontsize=12 fontname=Courier style=filled];
    edge[color=blue];
    rankdir=LR;

subgraph cluster_us_data  {
    node [shape=record fontsize=12 fontname=Courier style=filled];
    color = lightgray;
    style=filled;
    label = <span style="color: rgb(255, 0, 255);">"Struct us_data "</span>;
    edge[color=<span style="color: rgb(255, 0, 255);">"#2e3436"</span>];
        node_us_data [shape=record label=<span style="color: rgb(255, 0, 255);">"<span class="tag">&lt;<span class="title">f0</span>&gt;</span>*** STRUCT us_data  ***|\
<span class="tag">&lt;<span class="title">f2</span>&gt;</span>struct mutex     dev_mutex\l|\
<span class="tag">&lt;<span class="title">f3</span>&gt;</span>struct usb_device *pusb_dev\l|\
<span class="tag">&lt;<span class="title">f4</span>&gt;</span>struct usb_interface *pusb_intf\l|\
<span class="tag">&lt;<span class="title">f5</span>&gt;</span>struct us_unusual_dev   *unusual_dev\l|\
<span class="tag">&lt;<span class="title">f6</span>&gt;</span>unsigned long    fflags\l|\
<span class="tag">&lt;<span class="title">f7</span>&gt;</span>unsigned long    dflags\l|\
<span class="tag">&lt;<span class="title">f8</span>&gt;</span>unsigned int     send_bulk_pipe\l|\
<span class="tag">&lt;<span class="title">f9</span>&gt;</span>unsigned int     recv_bulk_pipe\l|\
<span class="tag">&lt;<span class="title">f10</span>&gt;</span>unsigned int    send_ctrl_pipe\l|\
<span class="tag">&lt;<span class="title">f11</span>&gt;</span>unsigned int    recv_ctrl_pipe\l|\
<span class="tag">&lt;<span class="title">f12</span>&gt;</span>unsigned int    recv_intr_pipe\l|\
<span class="tag">&lt;<span class="title">f13</span>&gt;</span>char        *transport_name\l|\
<span class="tag">&lt;<span class="title">f14</span>&gt;</span>char        *protocol_name\l|\
<span class="tag">&lt;<span class="title">f15</span>&gt;</span>__le32      bcs_signature\l|\
<span class="tag">&lt;<span class="title">f16</span>&gt;</span>u8      subclass\l|\
<span class="tag">&lt;<span class="title">f17</span>&gt;</span>u8      protocol\l|\
<span class="tag">&lt;<span class="title">f18</span>&gt;</span>u8      max_lun\l|\
<span class="tag">&lt;<span class="title">f19</span>&gt;</span>u8      ifnum\l|\
<span class="tag">&lt;<span class="title">f20</span>&gt;</span>u8      ep_bInterval\l|\
<span class="tag">&lt;<span class="title">f21</span>&gt;</span>trans_cmnd  transport\l|\
<span class="tag">&lt;<span class="title">f22</span>&gt;</span>trans_reset     transport_reset\l|\
<span class="tag">&lt;<span class="title">f23</span>&gt;</span>proto_cmnd  proto_handler\l|\
<span class="tag">&lt;<span class="title">f24</span>&gt;</span>struct scsi_cmnd *srb\l|\
<span class="tag">&lt;<span class="title">f25</span>&gt;</span>unsigned int    tag\l|\
<span class="tag">&lt;<span class="title">f26</span>&gt;</span>char        scsi_name[32]\l|\
<span class="tag">&lt;<span class="title">f27</span>&gt;</span>struct urb  *current_urb\l|\
<span class="tag">&lt;<span class="title">f28</span>&gt;</span>struct usb_ctrlrequest *cr\l|\
<span class="tag">&lt;<span class="title">f29</span>&gt;</span>struct usb_sg_request current_sg\l|\
<span class="tag">&lt;<span class="title">f30</span>&gt;</span>unsigned char   *iobuf\l|\
<span class="tag">&lt;<span class="title">f31</span>&gt;</span>dma_addr_t  iobuf_dma\l|\
<span class="tag">&lt;<span class="title">f32</span>&gt;</span>struct task_struct *ctl_thread\l|\
<span class="tag">&lt;<span class="title">f33</span>&gt;</span>struct completion cmnd_ready\l|\
<span class="tag">&lt;<span class="title">f34</span>&gt;</span>struct completion notify\l|\
<span class="tag">&lt;<span class="title">f35</span>&gt;</span>wait_queue_head_t delay_wait\l|\
<span class="tag">&lt;<span class="title">f36</span>&gt;</span>struct completion scanning_done\l|\
<span class="tag">&lt;<span class="title">f37</span>&gt;</span>void        *extra\l|\
<span class="tag">&lt;<span class="title">f38</span>&gt;</span>extra_data_destructor extra_destructor\l|\
<span class="tag">&lt;<span class="title">f39</span>&gt;</span>pm_hook         suspend_resume_hook\l|\
<span class="tag">&lt;<span class="title">f40</span>&gt;</span>int         use_last_sector_hacks\l|\
<span class="tag">&lt;<span class="title">f41</span>&gt;</span>int         last_sector_retries\l|<span class="tag">&lt;<span class="title">f999</span>&gt;</span>\
"</span>];
}

subgraph cluster_usb_ctrlrequest  {
    node [shape=record fontsize=12 fontname=Courier style=filled];
    color = lightgray;
    style=filled;
    label = <span style="color: rgb(255, 0, 255);">"Struct usb_ctrlrequest "</span>;
    edge[color=<span style="color: rgb(255, 0, 255);">"#2e3436"</span>];
        node_usb_ctrlrequest [shape=record label=<span style="color: rgb(255, 0, 255);">"<span class="tag">&lt;<span class="title">f0</span>&gt;</span>*** STRUCT usb_ctrlrequest  ***|\
<span class="tag">&lt;<span class="title">f2</span>&gt;</span>__u8 bRequestType\l|\
<span class="tag">&lt;<span class="title">f3</span>&gt;</span>__u8 bRequest\l|\
<span class="tag">&lt;<span class="title">f4</span>&gt;</span>__le16 wValue\l|\
<span class="tag">&lt;<span class="title">f5</span>&gt;</span>__le16 wIndex\l|\
<span class="tag">&lt;<span class="title">f6</span>&gt;</span>__le16 wLength\l|<span class="tag">&lt;<span class="title">f999</span>&gt;</span>\
"</span>];
}

subgraph cluster_usb_sg_request  {
    node [shape=record fontsize=12 fontname=Courier style=filled];
    color = lightgray;
    style=filled;
    label = <span style="color: rgb(255, 0, 255);">"Struct usb_sg_request "</span>;
    edge[color=<span style="color: rgb(255, 0, 255);">"#2e3436"</span>];
        node_usb_sg_request [shape=record label=<span style="color: rgb(255, 0, 255);">"<span class="tag">&lt;<span class="title">f0</span>&gt;</span>*** STRUCT usb_sg_request  ***|\
<span class="tag">&lt;<span class="title">f2</span>&gt;</span>int      status\l|\
<span class="tag">&lt;<span class="title">f3</span>&gt;</span>size_t       bytes\l|\
<span class="tag">&lt;<span class="title">f4</span>&gt;</span>spinlock_t   lock\l|\
<span class="tag">&lt;<span class="title">f5</span>&gt;</span>struct usb_device *dev\l|\
<span class="tag">&lt;<span class="title">f6</span>&gt;</span>int      pipe\l|\
<span class="tag">&lt;<span class="title">f7</span>&gt;</span>int      entries\l|\
<span class="tag">&lt;<span class="title">f8</span>&gt;</span>struct urb   **urbs\l|\
<span class="tag">&lt;<span class="title">f9</span>&gt;</span>int      count\l|\
<span class="tag">&lt;<span class="title">f10</span>&gt;</span>struct completion complete\l|<span class="tag">&lt;<span class="title">f999</span>&gt;</span>\
"</span>];
}

node_us_data:f28 -&gt; node_usb_ctrlrequest:f0;
node_us_data:f29 -&gt; node_usb_sg_request:f0[color=brown];
node_us_data:f29 -&gt; node_usb_sg_request:f999[color=brown];

}</pre>
          <p>
            生成的图下如下：
            <br>
          </p>
          <div style="width: 160px;">
            <a href="https://dea.googlecode.com/svn/trunk/screenshots/graphviz-ds.png" rel="lightbox">
              <img style="" src="thumbs_graphviz-ds.png" height="150">
            </a>
            <p>graphviz ds</p>
          </div>
        </li>
      </ul>
    </div>
  </div>
  <div>
    <h3>
      <span>5</span>
      后记
    </h3>
    <div>
      <p>功能上还有很多地方可以改进，比如通过 CEDET 的 Semantic 进行语义分析，参考 corge 代码，支持 C++ 中的 class 等等。以后有时间在改改。PS: 貌似写这个 blog 用的时间比写那个 elisp 代码更费时间 ……</p>
    </div>
  </div>
</div>

        </div>
        <div class="article_social">
         <div class="article_like">
    <div class="circle circle-like" id="my_zan" data_id="I7ZvEj">  </div>

</div>
        <div id="share_weixin_image">
            <img src="qrcode.php" height="100px" width="100px">
        </div>
<div class="article_share_fav">
    <div class="share" id="ckepop">
        <span>分享</span>
        <button class="share_weibo" id="share_weibo_id" title="分享到新浪微博"></button>
        <button class="share_qq" id="share_qq_id" title="分享到QQ空间"></button>
        <button class="share_weixin" id="share_weixin_id"></button>
    </div>
    <div class="fav_correct">
        <button id="my_fav" data_id="I7ZvEj">
            <i class="icon icon-star-empty"></i> <span id="fav_tip">收藏</span>
        </button>
        <button id="article-correct" data_id="I7ZvEj" uid="0">
            <i class="icon icon-warning-sign"></i>
            <span>纠错</span>
        </button>
    </div>
</div>



            <div class="bottom_ad huodong-detail-ad-banner clearfix">
                  <a href="https://www.jiguang.cn/?from=tuicool01" target="_blank"><img src="jpush700.jpg"></a>

            </div>
        </div>
        <div id="site_articles" style="clear: both;">
              <div class="article-part-title">
                <span>推荐文章</span>
              </div>
          <ul class="side_article_list">
                <li class="side_article_list_item">
                    1.<a href="http://www.tuicool.com/articles/RJbieii" target="_blank" title="Vim 异步编译插件 vimmake">
                    Vim 异步编译插件 vimmake
                    </a>
                </li>
                <li class="side_article_list_item">
                    2.<a href="http://www.tuicool.com/articles/YvU3E32" target="_blank" title="总结：Sublime Text3 快捷键 （Windows版）">
                    总结：Sublime Text3 快捷键 （Windows版）
                    </a>
                </li>
                <li class="side_article_list_item">
                    3.<a href="http://www.tuicool.com/articles/Uniy6jE" target="_blank" title="centos6环境下搭建irc服务器">
                    centos6环境下搭建irc服务器
                    </a>
                </li>
                <li class="side_article_list_item">
                    4.<a href="http://www.tuicool.com/articles/yQz6B32" target="_blank" title="LinuxShell脚本之利用rsync+ssh实现Linux文件系统远程备份">
                    LinuxShell脚本之利用rsync+ssh实现Linux文件系统远程备份
                    </a>
                </li>
                <li class="side_article_list_item">
                    5.<a href="http://www.tuicool.com/articles/ba2eErr" target="_blank" title="Marp —— Markdown 演示编写器">
                    Marp —— Markdown 演示编写器
                    </a>
                </li>
                <li class="side_article_list_item">
                    6.<a href="http://www.tuicool.com/articles/BN322e3" target="_blank" title="adb截屏录制">
                    adb截屏录制
                    </a>
                </li>
          </ul>
        </div>
        <div id="kan_articles"> <div class="article-part-title"> <span>相关推刊</span></div><ul class="kan-list">          <li class="kan-item">            <a href="http://www.tuicool.com/kans/592321163" target="_blank" class="kan-item-head">              <small>by 吴雄琉bear</small>              <img class="kan-cover" src="numqQf.png!kan">            </a>            <span class="kan-detail">              <a href="http://www.tuicool.com/kans/592321163" target="_blank">《emacs》</a>              <i class="kan-num">3</i>            </span>          </li>        </ul><i class="clearfix"></i></div>
        <div id="article_weibo" style="display: none;">
            <div class="article-part-title">
                <span>相关微博</span>
                <sub>
                    <a href="http://www.tuicool.com/articles/weibo_list/I7ZvEj" target="_blank">(<i id="weibo_num"></i>)</a> 
               </sub>
            </div>
            <div class="related-weibo-list"></div>
        </div>
        <div class="comments">
    <div class="comments-area">
    <div class="comments-header">
        <h5>我来评几句</h5>
        <div class="alert comment-alert alert-error" style="display: none;">
            错误
        </div>
            <textarea cols="60" rows="5" id="comment-body" placeholder="请输入评论内容..." style="resize: none;"></textarea>
            <span class="btn btn-medium btn-submit" id="comment-submit">登录后评论</span>
        <p style="margin-top: 5px; margin-left: 10px;">
            已发表评论数(<span class="comment_cnt">0</span>)
        </p>
    </div>
    <div class="comments-list">
        <div class="empty-cmts alert alert-success" style="display: none;">
            没有更多评论了^^
        </div>
    </div>
    <div class="more-comments" style="display: none;">
        <a href="#">更多评论</a>
    </div>
    <div class="load-fail" style="display: none;">
        评论加载失败，<a>重新加载</a>
    </div>
    </div>
</div>

    </div>
        <div class="span4 article_right_side">
            <div class="right_top">
    <div class="article_related_site article_detail_bg">
    <h4 class="article-part-title">相关站点</h4>
    <div class="article_related_site_body clearfix">
        <div class="logo">
            <img src="7VvUfu.png">
        </div>
        <div class="name">
            <div>
                <a href="http://www.tuicool.com/sites/7VvUfu" target="_blank"> Emacs中文网</a>
            </div>
            <div>
                <div class="btn btn-success right_site_follow" id="my_follow" data_id="7VvUfu">＋订阅</div>
            </div>
        </div>
    </div>
</div>

<div id="right_site_articles" class="article_detail_bg">
    <div class="article-part-title">
        <span>热门文章</span>
    </div>
    <ul class="side_article_list">
        <li class="side_article_list_item">
            1.<a href="http://www.tuicool.com/articles/uUzUV3r" target="_blank" title="Linux Thermal 框架解析"> Linux Thermal 框架解析 </a>
        </li>
        <li class="side_article_list_item">
            2.<a href="http://www.tuicool.com/articles/RJbieii" target="_blank" title="Vim 异步编译插件 vimmake"> Vim 异步编译插件 vimmake </a>
        </li>
        <li class="side_article_list_item">
            3.<a href="http://www.tuicool.com/articles/YvU3E32" target="_blank" title="总结：Sublime Text3 快捷键 （Windows版）"> 总结：Sublime Text3 快捷键 （Windows版） </a>
        </li>
        <li class="side_article_list_item">
            4.<a href="http://www.tuicool.com/articles/Uniy6jE" target="_blank" title="centos6环境下搭建irc服务器"> centos6环境下搭建irc服务器 </a>
        </li>
        <li class="side_article_list_item">
            5.<a href="http://www.tuicool.com/articles/yQz6B32" target="_blank" title="LinuxShell脚本之利用rsync+ssh实现Linux文件系统远程备份"> LinuxShell脚本之利用rsync+ssh实现Linux文件系统远程备份 </a>
        </li>
    </ul>
</div>


      <div class="right-ad">
              <a href="https://www.jiguang.cn/?from=tuicool01" target="_blank"><img src="jpush120.jpg"></a>

      </div>
      <div class="right-ad" style="margin-top: 5px;">
              <a href="https://www.teambition.com/?utm_source=tuicool&amp;utm_medium=banner01" target="_blank"><img src="teambition120.jpg"></a>

      </div>
      <div class="right-ad" style="margin-top: 5px;">
              <a href="http://www.bigniu.com/?f=tc" target="_blank"><img src="bigniu120.jpg"></a>

      </div>
<div class="right-ad" style="margin-top: 5px;">
      <a href="http://click.aliyun.com/m/5256/" target="_blank"><img src="aliyun120.jpg"></a>

</div>
      <div class="right-ad" style="margin-top: 5px;">
              <a href="http://www.jiankongbao.com/?f=tuicool" target="_blank"><img src="jiankongbao120.jpg"></a>

      </div>
<div class="right-ad" style="margin-top: 5px;">
      <a href="http://www.handone.com/?f=tc" target="_blank"><img src="handone300.jpg"></a>

</div>
<div class="right-ad" style="margin-top: 5px;">
      <a href="http://www.vc3market.com/?f=tc" target="_blank"><img src="vc3market120.jpg"></a>

</div>
</div>
<div class="operate_zone">
      <div class="right-ad" style="margin-top: 0px;">
              <a href="http://blog.daocloud.io/jobs/?utm_source=tuicool&amp;utm_medium=banner&amp;utm_content=hiring&amp;utm_campaign=hirecampaign" target="_blank"><img src="daocloud300.jpg"></a>

      </div>
        <div class="frd_pos">
        
<ins class="adsbygoogle" style="display: inline-block; width: 300px; height: 250px;" data-ad-client="ca-pub-7054762349007490" data-ad-slot="5705695566"></ins>


        </div>
</div>
         </div>
</div>

<div>
   <!-- add_article to kan -->
<div id="add-article-to-kan" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <span class="add-title">收藏到推刊</span>
    <a href="#new-kan" class="btn pull-right" data-toggle="modal">创建推刊</a>
    <i class="clearfix"></i>
  </div>
  <div class="modal-body">
    <ul id="add-kan-list">
    </ul>
  </div>
  <div class="modal-footer">
    <input value="I7ZvEj" class="article-id" type="hidden"> 
    <button class="btn btn-primary pull-left add-to-btn">  收 藏  </button>
    <button class="btn" data-dismiss="modal" aria-hidden="true" style="margin-right: 15px;">取消</button>
  </div>
</div>

   <div id="new-kan" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-body">
    <input name="name" id="new-kan-name" placeholder="推刊名(必填)" required="" data-validation-required-message="请填写推刊名" type="text">
    <span class="new-ness-name">请填写推刊名</span>
    <br>
    <textarea name="desc" id="desc" rows="6" placeholder="推刊描述"></textarea>
    <span class="new-ness-desc">描述不能大于100个字符!</span>
    <br>
    权限设置：<input name="type" value="1" checked="checked" type="radio"> 公开
    <input name="type" value="0" type="radio"> 仅自己可见
  </div>
  <div class="modal-footer">
    <button class="btn btn-primary pull-left create-kan-btn" disabled="">创建</button>
    <button class="btn dismiss-new-kan" data-dismiss="modal" aria-hidden="true">取消</button>
  </div>
</div>


</div>
<div id="article-correct-modal" class="modal hide fade in" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
            ×
        </button>
        <h3>文章纠错</h3>
    </div>
    <div class="modal-body">
        <input value="I7ZvEj" id="article-correct-source" type="hidden">
        <div>
            <label for="article-correct-email">
                邮箱地址
            </label>
            <input id="article-correct-email" class="input-large" type="email">
        </div>
        <div>
            <label for="article-correct-select">
                错误类型
            </label>
            <select id="article-correct-select">
                <option value="正文不准确">正文不准确</option>
                <option value="标题不准确">标题不准确</option>
                <option value="排版有问题">排版有问题</option>
                <option value="排版有问题">主题不准确</option>
                <option value="没有分页内容">没有分页内容</option>
                <option value="图片无法显示">图片无法显示</option>
                <option value="视频无法显示">视频无法显示</option>
                <option value="与原文不一致">与原文不一致</option>
            </select>
        </div>
        <div>
            <label for="article-correct-other">
                补充信息
            </label>
            <textarea id="article-correct-other" class="span4"></textarea>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary pull-right huodong_correct_submit" id="article-correct-submit">
            &nbsp;&nbsp;提交&nbsp;&nbsp;
        </button>
    </div>
</div>






    <div class="loader-inner ball-pulse ball-loading-center" id="page-loading" style="display: none;">
      <div></div>
      <div></div>
      <div></div>
    </div>
    <div class="read-later-alert"></div>
  </div>

    <div class="footer">
    <div class="footer-inner">
    <dl class="about-link site-link">
        <dt>
            网站相关
        </dt>
        <dd>
            <a target="_blank" href="http://www.tuicool.com/about">关于我们</a>
        </dd>
        <dd>
            <a target="_blank" href="http://www.tuicool.com/mobile">移动应用</a>
        </dd>
        <dd>
            <a target="_blank" href="http://www.tuicool.com/bbs/go/issues">建议反馈</a>
        </dd>
    </dl>
    <dl class="site-link follow-link">
        <dt>
            关注我们
        </dt>
        <dd>
            <a target="_blank" href="http://e.weibo.com/tuicool2012"><img src="weibo-32.png">推酷网</a>
        </dd>
        <dd><img src="weixin-32.png">tuicool2012
        </dd>
    </dl>
    <dl class="site-link links">
        <dt>
            友情链接
        </dt>
        <dd>
                <a href="http://www.woshipm.com/" title="人人都是产品经理" target="_blank">人人都是产品经理</a>
                <a href="http://www.pm265.com/" title="PM256" target="_blank">PM256</a>
                <a href="http://www.yidonghua.com/" title="移动信息化" target="_blank">移动信息化</a>
                <a href="http://www.snsiu.com/" title="行晓网" target="_blank">行晓网</a>
                <a href="http://www.taskcity.com/" title="智城外包网" target="_blank">智城外包网</a>
                <a href="http://www.huxiu.com/" title="虎嗅" target="_blank">虎嗅</a>
                <a href="http://www.iterduo.com/" title="IT耳朵" target="_blank">IT耳朵</a>
                <a href="http://mediaworks.caixin.com/" title="创媒工场" target="_blank">创媒工场</a>
                <a href="http://www.managershare.com/" title="经理人分享" target="_blank">经理人分享</a>
                <a href="http://www.shichangbu.com/" title="市场部网" target="_blank">市场部网</a>
                <a href="http://www.ikanchai.com/" title="砍柴网" target="_blank">砍柴网</a>
                <a href="http://www.cocoachina.com/" title="CocoaChina" target="_blank">CocoaChina</a>
                <a href="http://www.ibeifeng.com/" title="北风网" target="_blank">北风网</a>
                <a href="http://www.jiankongbao.com/" title="云智慧" target="_blank">云智慧</a>
                <a href="http://www.wyzc.com/" title="我赢职场" target="_blank">我赢职场</a>
                <a href="http://www.thebigdata.cn/" title="大数据时代" target="_blank">大数据时代</a>
                <a href="http://www.qidic.com/" title="奇笛网" target="_blank">奇笛网</a>
                <a href="http://www.cngulu.com/" title="咕噜网" target="_blank">咕噜网</a>
                <a href="http://www.linuxdiyf.com/" title="红联linux" target="_blank">红联linux</a>
                <a href="http://win10.ithome.com/" title="Win10之家" target="_blank">Win10之家</a>
                <a href="http://www.niaogebiji.com/" title="鸟哥笔记" target="_blank">鸟哥笔记</a>
                <a href="http://www.play.cn/" title="爱游戏" target="_blank">爱游戏</a>
                <a href="http://www.investide.cn/" title="投资潮" target="_blank">投资潮</a>
                <a href="http://www.31huiyi.com/" title="31会议网" target="_blank">31会议网</a>
                <a href="https://www.jiguang.cn/" title="极光推送" target="_blank">极光推送</a>
                <a href="https://www.teambition.com/" title="Teambition" target="_blank">Teambition</a>
                <a href="http://www.guigu.org/" title="硅谷网" target="_blank">硅谷网</a>
                <a href="https://home.leangoo.com/" title="leangoo" target="_blank">leangoo</a>
                <a href="http://www.zealer.com/" title="ZEALER中国" target="_blank">ZEALER中国</a>
                <a href="http://www.opensns.cn/" title="OpenSNS" target="_blank">OpenSNS</a>
                <a href="http://www.edu360.cn/" title="小牛学堂" target="_blank">小牛学堂</a>
                <a href="http://www.handone.com/" title="handone" target="_blank">handone</a>
                <a href="http://www.scrumcn.com/" title="Scrum中文网" target="_blank">Scrum中文网</a>
                <a href="http://www.bigniu.com/" title="比戈大牛" target="_blank">比戈大牛</a>
                <a href="https://www.upyun.com/" title="又拍云" target="_blank">又拍云</a>
            <a href="http://www.tuicool.com/links">更多链接&gt;&gt;</a>&nbsp;&nbsp;
        </dd>
    </dl>
    <div class="clear"></div>
    </div>
</div>

<div style="display: none;">
   
</div>




<div style="display: none;" title="返回顶部" class="return"></div></body>
</html>
