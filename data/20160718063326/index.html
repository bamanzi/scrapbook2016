<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>邪恶的 eshell · LinuxTOY</title>
        
        <!--[if lte IE 8]>
        <link rel="stylesheet" href="https://linuxtoy.org/theme/css/grids-responsive-old-ie-min.css">
        <link rel="stylesheet" href="https://linuxtoy.org/theme/css/side-menu-old-ie.css">
        <![endif]-->
        <!--[if gt IE 8]><!-->
        
        
        <!--<![endif]-->
        
        <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
        <link rel="alternate" type="application/atom+xml" href="https://linuxtoy.org/feeds/all.atom.xml" title="LinuxTOY Atom Feed">
        <!--[if IE]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        
        
        <meta name="keywords" content="Linux, 自由软件, 新闻, 教程，提示">
        <meta name="description" content="对于一个经常“被跨平台”的人来说，Windows 下没有一个好用的 shell，不能不说是一个 遗憾。 虽然说 bash zsh 都有 windows 的版本，但几乎一无是处……此处暂省略1000字，且不说应有 尽没的功能，光是那速度就让人抓狂，动不动装死，让人想撞死，还不如 eshell 来的机灵……等等， eshell 不就是天生跨平台的 shell 么？ 当然 ...">
        <meta name="subject" content="Linux 新闻、应用及提示">

        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@linuxtoy">
        <meta name="twitter:creator" content="@linuxtoy">
        <meta name="twitter:url" content="https://linuxtoy.org/archives/emacs-eshell.html">
        <meta name="twitter:title" content="邪恶的 eshell">
        <meta name="twitter:description" content="对于一个经常“被跨平台”的人来说，Windows 下没有一个好用的 shell，不能不说是一个 遗憾。 虽然说 bash zsh 都有 windows 的版本，但几乎一无是处……此处暂省略1000字，且不说应有 尽没的功能，光是那速度就让人抓狂，动不动装死，让人想撞死，还不如 eshell 来的机灵……等等， eshell 不就是天生跨平台的 shell 么？ 当然 ...">
        <meta name="twitter:image" content="https://linuxtoy.org/logo.png">
        <meta property="og:url" content="https://linuxtoy.org/archives/emacs-eshell.html">
        <meta property="og:type" content="website">
        <meta property="og:title" content="邪恶的 eshell">
        <meta property="og:image" content="https://linuxtoy.org/logo.png">
        <meta property="og:description" content="对于一个经常“被跨平台”的人来说，Windows 下没有一个好用的 shell，不能不说是一个 遗憾。 虽然说 bash zsh 都有 windows 的版本，但几乎一无是处……此处暂省略1000字，且不说应有 尽没的功能，光是那速度就让人抓狂，动不动装死，让人想撞死，还不如 eshell 来的机灵……等等， eshell 不就是天生跨平台的 shell 么？ 当然 ...">
        <meta property="og:site_name" content="LinuxTOY">
        <meta property="article:author" content="Kardinal">
        <link rel="canonical" href="https://linuxtoy.org/archives/emacs-eshell.html">
    
<link rel="stylesheet" type="text/css" href="index.css" media="all">
</head>
    <body>
        <div id="layout" class="pure-g">
            <div class="sidebar pure-u-1">
                <div class="header">
                    <a id="menuLink" class="menu-link" href="#menu"><span></span></a>
                    <div id="menu" class="pure-menu">
                        <a class="pure-menu-heading" href="https://linuxtoy.org/" title="LinuxTOY">LinuxTOY</a>
                        <ul class="pure-menu-list">

                            <li class="pure-menu-item">
                                <a class="pure-menu-link" href="https://linuxtoy.org/pages/all-archives.html" title="Archives">Archives</a>
                            </li>
                            <li class="pure-menu-item">
                                <a class="pure-menu-link" href="https://linuxtoy.org/pages/books.html" title="Books">Books</a>
                            </li>
                            <li class="pure-menu-item">
                                <a class="pure-menu-link" href="https://linuxtoy.org/pages/talks.html" title="Talks">Talks</a>
                            </li>
                            <li class="pure-menu-item">
                                <a class="pure-menu-link" href="https://linuxtoy.org/pages/download.html" title="Download">Download</a>
                            </li>
                            <li class="pure-menu-item">
                                <a class="pure-menu-link" href="https://linuxtoy.org/pages/faq.html" title="FAQs">FAQs</a>
                            </li>
                            <li class="pure-menu-item">
                                <a class="pure-menu-link" href="https://linuxtoy.org/pages/contact.html" title="Contact">Contact</a>
                            </li>
                            <li class="pure-menu-item">
                                <a class="pure-menu-link" href="https://linuxtoy.org/pages/donate.html" title="Donate">Donate</a>
                            </li>
                            <li class="pure-menu-item">
                                <a class="pure-menu-link" href="https://linuxtoy.org/pages/license.html" title="License">License</a>
                            </li>
                            <li class="pure-menu-item">
                                <a class="pure-menu-link" href="https://linuxtoy.org/pages/links.html" title="Links">Links</a>
                            </li>

                            <li class="pure-menu-item">
                                <a class="pure-menu-link" href="https://linuxtoy.org/pages/comments.html" title="Comments">Comments</a>
                            </li>
                            <li class="pure-menu-item">
                                <a class="pure-menu-link" href="https://linuxtoy.org/random.html" title="Random">Random</a>
                            </li>
                            <li class="pure-menu-item">
                                <a class="pure-menu-link" href="https://linuxtoy.org/feeds/all.atom.xml" title="RSS">RSS</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

<div class="content pure-u-1 pure-u-md-3-5">
    <div class="posts">
        <section class="post">
            <header class="post-header">
                <h2 class="post-title">
                    <a href="#" rel="bookmark" title="Permalink to 邪恶的 eshell">邪恶的 eshell</a>
                </h2>
                <p class="post-meta">
                    2011-10-16
                    · By
                    <a href="https://linuxtoy.org/author/kardinal.html">Kardinal</a>
                    · Posted in <a href="https://linuxtoy.org/category/news.html">News</a>
                    · <a href="#disqus_thread">47 Comments</a>
                </p>
            </header>
            <div class="post-description">
            <p>对于一个经常“被跨平台”的人来说，Windows 下没有一个好用的
shell，不能不说是一个<br>
遗憾。</p>
<p>虽然说 bash zsh 都有 windows
的版本，但几乎一无是处……此处暂省略1000字，且不说应有<br>
尽没的功能，光是那速度就让人抓狂，动不动装死，让人想撞死，还不如 eshell
来的机灵……等等，<br>
eshell 不就是天生跨平台的 shell 么？</p>
<p>当然，要用 eshell 必需要有 emacs，因为它就是用 elisp 写的。你不能把它从
emacs 里面抠出来单独使用……就像你不能把 emacs
从屏幕里抠出来单独使用，一样一样的  </p>
<p>废话不多说，这回先上图  </p>
<p><a href="http://linuxtoy.org/img/2011/10/eshell.png"><img alt="" src="eshell.png"></a></p>
<p>eshell 够坏的，shell 里面能用 outline，我还真不知道有别的 shell 或者
editor 能够做到……淘气！</p>
<p>当然，仅仅一个 outline mode 还不能称得上 evil ，eshell 里面可以同时使用
shell 和 elisp 两种语言。</p>
<div class="highlight"><pre>cmd $(elisp)
$(shell-command-to-string "cmd")
</pre></div>


<p>$ 不是必须的，甚至最外层的括号也可以省略，不过据说可能会出问题</p>
<p>eshell 还有变态的修饰器和文件类型断言</p>
<div class="highlight"><pre>echo *(:U) =&gt; ("BAR" "BIN/" "DEV/" "ETC/" "FOO" "HOME/" "LIB/" "TMP/" "USR/" "VAR/")
</pre></div>


<p>(:U) 括弧中以冒号开头的是修饰器，U 表示转换为大写。</p>
<div class="highlight"><pre>echo *(^/) =&gt; ("bar" "foo")
</pre></div>


<p>(^/) 就是文件类型断言了，/ 表示文件夹，前面的 ^ 表示 非</p>
<div class="highlight"><pre>echo ("foo" "bar" "baz" "foo")(:gs/foo/blarg/)
=&gt; ("blarg" "bar" "baz" "blarg")
</pre></div>


<p>是不是有点眼熟？请自由联想……需要注意的是，修饰器和文件类型断言要紧跟在列表的后<br>
面。你没有看错，前面例子中的 * 不是列表，从哪个角度看都不是，但它爸是
eshell，所以它叫通配符</p>
<p>如果想了解更多修饰器和文件类型断言的信息，M-x
eshell-modifier(predicate)-alist<br>
不过符号是用数字表示的，理解起来有一定难度，点那个 customize 的链接。</p>
<p>下面又到了每月一次的配置文件时间</p>
<p>首先绑定一个快速启动 eshell 的快捷键，我绑定的是 C-x C-x
。如果想多开，加个前缀<br>
参数就可以了，比如 C-u C-x C-x 。</p>
<div class="highlight"><pre>(add-hook 'eshell-mode-hook (lambda()
           (outline-minor-mode 1)
           (color-theme-my-eshell)
           (setq outline-regexp "^[^#$\n]* [#&gt;]+ "
                 scroll-margin 0
                 eshell-scroll-to-bottom-on-output t
                 eshell-scroll-show-maximum-output t)
           (add-to-list 'eshell-output-filter-functions 
                        'eshell-postoutput-scroll-to-bottom)
           (def-key-s eshell-mode-map 
             "&lt;up&gt;"     'eshell-previous-matching-input-from-input
             "&lt;down&gt;"   'eshell-next-matching-input-from-input
             "&lt;tab&gt;"    'user-tab
             "&lt;return&gt;" 'user-ret
              "SPC"      'user-spc
)
))
</pre></div>


<p>尽管 eshell 也有 auto cd
的功能，就是输入目录回车，自动cd；不过我还是习惯空行按<br>
tab 补全 cd ，那样比较一致。</p>
<p>我把这几个键的功能整理到一个文件里了，需要的时候 require 一下就可以了  </p>
<p><a href="http://linuxtoy.org/img/2011/10/eshell-user-keyel.txt">eshell-user-key.el</a></p>
<div class="highlight"><pre>;tab 空格再tab ，就会变成 cd -0，一直按tab，数字一直加
(defun user-tab ()
</pre></div>


<p>狠了狠心，我又加了一个 user-ret 。男人嘛，就应该对 Shell 狠一点</p>
<div class="highlight"><pre>(defun user-ret ()
</pre></div>


<p>这个函数的作用是，空行按回车自动 ls; 展开 "..."=&gt;"../.." ;
"...."=&gt;"../../.." ……狠不狠？</p>
<p>还是不够狠啊……</p>
<div class="highlight"><pre>(defun user-spc ()
</pre></div>


<p>下面是一些基本设置，不解释</p>
<div class="highlight"><pre>(setq
      eshell-save-history-on-exit   t
      eshell-history-size           512
      eshell-hist-ignoredups        t
      eshell-cmpl-ignore-case       t
      eshell-cp-interactive-query   t
      eshell-ln-interactive-query   t
      eshell-mv-interactive-query   t
      eshell-rm-interactive-query   t
      eshell-mv-overwrite-files     nil
      ;; aliases-file 里面不能有多余的空行，否则会报正则表达式错误
      eshell-aliases-file       (expand-file-name "_eshell/eshell-alias" init-dir)

      eshell-highlight-prompt   t
      ;; 提示符设置，下面两项必须对应起来，
      ;; 否则会报 read-only，并且不能补全什么的
      eshell-prompt-regexp      "^[^#$\n]* [#&gt;]+ "
      eshell-prompt-function    (lambda nil
                                  (concat
                                   (abbreviate-file-name
                                    (eshell/pwd))
                                   (if
                                       (=
                                        (user-uid)
                                        0)
                                       " # " " &gt;&gt;&gt; ")))
)
</pre></div>


<p>作为一个有时间观念的人，我需要知道每一个命令花了多少时间。。。其实我总觉得<br>
eshell 有点慢，这样心里感觉踏实一点 -__-!!!</p>
<div class="highlight"><pre>(add-hook 'eshell-load-hook
          (lambda()(setq last-command-start-time (time-to-seconds))))
(add-hook 'eshell-pre-command-hook
          (lambda()(setq last-command-start-time (time-to-seconds))))
(add-hook 'eshell-before-prompt-hook
          (lambda()
              (message "spend %g seconds"
                       (- (time-to-seconds) last-command-start-time))))
</pre></div>


<p>设置一些常用的命令</p>
<div class="highlight"><pre>(defalias 'ff 'find-file)
(defalias 'ee (lambda()(find-file (expand-file-name "44_eshell.el" init-dir))))
(defalias 'aa (lambda()(find-file eshell-aliases-file)))
(defalias 'rr (lambda()(find-file (expand-file-name "_qref.org" sand-box))))
(defalias 'ss  'shell-command-to-string)
</pre></div>


<p>差点忘了，auto-complete 设置</p>
<div class="highlight"><pre>(defvar ac-source-eshell-pcomplete
  '((candidates . (pcomplete-completions))))
(defun ac-complete-eshell-pcomplete ()
  (interactive)
  (auto-complete '(ac-source-eshell-pcomplete)))
;; 自动开启 ac-mode
;; 需要 (global-auto-complete-mode 1)
(add-to-list 'ac-modes 'eshell-mode)
(setq ac-sources '(ac-source-eshell-pcomplete
                   ;; ac-source-files-in-current-dir
                   ;; ac-source-filename
                   ;; ac-source-abbrev
                   ;; ac-source-words-in-buffer
                   ;; ac-source-imenu
))
</pre></div>


<p>还有胡乱收集的一些小函数</p>
<div class="highlight"><pre>(defun eshell/ii (file)(ido-find-file file))
(defun eshell/ed (file1 file2)(ediff-files file1 file2))

;; 按一次 C-a 到命令在前面，再按一次到命令提示符的前面，感觉用处不大
(defun eshell-maybe-bol ()
  (interactive)
  (let ((p (point)))
    (eshell-bol)
    (if (= p (point))
        (beginning-of-line))))

(defun eshell/gvim (&amp;rest args)
  "Invoke `find-file' on the file.
\"vi +42 foo\" also goes to line 42 in the buffer."
  (while args
    (if (string-match "`\\+\\([0-9]+\\)\\'" (car args))
        (let* ((line (string-to-number (match-string 1 (pop args))))
               (file (pop args)))
          (find-file file)
          (goto-line line))
      (find-file (pop args)))))
</pre></div>


<p>我知道排版很混乱，但是 linuxtoy
现在还是没有语法高亮的插件，我也无能为力。。。这也算stay hungry stay
foolish的另一种诠释?(当然不是所谓的“求知若饥，虚心若愚”，这种翻译傻逼的让我吐血)</p>
<p>作为你忍受了这么久还能看到结尾的回报，我送上我精心配置的2.5个主题……其中有一个主题是我分析了某人网站的css文件提取出来的，折腾了半夜，另外那半个是
eshell 的主题<a href="http://linuxtoy.org/img/2011/10/colorel.txt">color.el</a><br>
需要 color-theme 支持……不过你可以把 color-theme-library.el 删了</p>
            <p class="post-meta">
                # 
                Edit on <a href="https://github.com/LinuxTOY/linuxtoy.org/blob/master/content/emacs-eshell.md">GitHub</a>
            </p>            <!-- <p class="post-meta">&num; <a href="http://resume.linuxtoy.org" title="若有兴趣，欢迎来电 :)">寻 GNU/Linux 相关工作，欢迎联系 :)</a></p> -->
            </div>
        </section>
        <h4>Read More:</h4>
        <div class="nav-left">
        
        <ins class="adsbygoogle" style="display: inline-block; width: 336px; height: 280px;" data-ad-client="ca-pub-9432205671574187" data-ad-slot="6128171428"></ins>
        
        </div>
    </div>
    <div id="disqus_thread"><iframe verticalscrolling="no" horizontalscrolling="no" src="index_1.html" style="width: 1px ! important; min-width: 100% ! important; border: medium none ! important; overflow: hidden ! important; height: 0px ! important;" title="Disqus" tabindex="0" scrolling="no" allowtransparency="true" name="dsq-app2" id="dsq-app2" frameborder="0" width="100%"></iframe></div>
    
    <div class="footer">
        <p class="nav-left">
            <a href="https://linuxtoy.org/archives/pseudo-random-vs-true-random.html">
                « 伪随机和真随机
            </a>
        </p>
        <p class="nav-right">
            <a href="https://linuxtoy.org/archives/mango-the-forth-film-from-blender-academy.html">
                芒果：Blender 学院的第四部电影项目 »
            </a>
        </p>
    </div>
</div>

<div class="content pure-u-1 pure-u-md-1-5">
    <div class="posts">
    
    <ins class="adsbygoogle" style="display: inline-block; width: 300px; height: 250px;" data-ad-client="ca-pub-9432205671574187" data-ad-slot="6262929029"></ins>
    
        <h1 class="content-subhead">Popular Posts</h1>
        <div class="pure-menu">
            <ul class="pure-menu-list">
                <li class="pure-menu-item"><a href="https://linuxtoy.org/archives/the-perfect-linux-desktop-arch-linux-2007-08-2-1.html">Archlinux 安装指南</a></li>
                <li class="pure-menu-item"><a href="https://linuxtoy.org/archives/unix-linux-command-cheat-sheet.html">Unix/Linux 命令速查表</a></li>
                <li class="pure-menu-item"><a href="https://linuxtoy.org/archives/efficient-editing-with-vim.html">高效率编辑器 Vim</a></li>
                <li class="pure-menu-item"><a href="https://linuxtoy.org/archives/wget-tips.html">Wget 使用技巧</a></li>
                <li class="pure-menu-item"><a href="https://linuxtoy.org/archives/playing-around-with-mplayer.html">玩转 MPlayer</a></li>
                <li class="pure-menu-item"><a href="https://linuxtoy.org/archives/awesome.html">平铺式窗口管理器 Awesome</a></li>
                <li class="pure-menu-item"><a href="https://linuxtoy.org/archives/3_free_antivirus_under_linux.html">Linux 下的桌面级杀毒软件</a></li>
                <li class="pure-menu-item"><a href="https://linuxtoy.org/archives/openbox-getting-started-guide.html">窗口管理器 Openbox 入门指南</a></li>
                <li class="pure-menu-item"><a href="https://linuxtoy.org/archives/minimalist-install-of-ubuntu.html">最小化安装 Ubuntu</a></li>
                <li class="pure-menu-item"><a href="https://linuxtoy.org/archives/5-desktop-environment-for-linux.html">你可能不知道的 Linux 桌面</a></li>
                <li class="pure-menu-item"><a href="https://linuxtoy.org/archives/the-7-deadly-linux-commands.html">7 个致命的 Linux 命令</a></li>
                <li class="pure-menu-item"><a href="https://linuxtoy.org/archives/lightweight-desktop-compare.html">轻量级桌面环境比较</a></li>
                <li class="pure-menu-item"><a href="https://linuxtoy.org/archives/zsh.html">终极 Shell——Zsh</a></li>
                <li class="pure-menu-item"><a href="https://linuxtoy.org/archives/6-of-the-best-free-linux-cad-software.html">高品质的免费 Linux CAD 程序</a></li>
                <li class="pure-menu-item"><a href="https://linuxtoy.org/archives/game_emulator_for_linux.html">Linux 下的几个游戏模拟器</a></li>
                <li class="pure-menu-item"><a href="https://linuxtoy.org/archives/history-command-usage-examples.html">History（历史）命令用法 15 例</a></li>
                <li class="pure-menu-item"><a href="https://linuxtoy.org/archives/the-best-tips-and-tricks-for-bash.html">bash 使用技巧</a></li>
                <li class="pure-menu-item"><a href="https://linuxtoy.org/archives/10-oreilly-books.html">10 本 O'Reilly 出版的免费好书</a></li>
            </ul>
        </div>
    </div>
</div>
        </div>

        
        
        
        


    
<div id="st-injected-content" data-st-install-key="zWjtxRdA6ciZ7LBm4R4K" class="st-injected-content-generated st-install-zWjtxRdA6ciZ7LBm4R4K">
<div class="st-ui-embed st-search-chrome-overlay-output st-search-escape-hide-outputs st-search-zoom-on-mobile" style="display: none;">
    <div class="st-ui-overlay st-search-hide-outputs"></div>
  <!-- Swiftype input and results overlay -->
  <div class="st-ui-container st-ui-container-overlay  st-ui-injected-overlay-container ">
    <!-- HEADER -->
    <div class="st-ui-container-header_bar st-position-container">
        <section class="st-ui-header">
          <form lpformnum="2">
            <input autocapitalize="off" autocorrect="off" autocomplete="off" class="st-default-search-input st-search-set-focus" value="" placeholder="Search this site" id="st-overlay-search-input" type="text">
          </form>
          <span class="st-ui-search-icon"></span>

            <a class="st-ui-close-button st-search-hide-outputs">Close</a>

            <a class="st-ui-stamp" href="https://swiftype.com/" target="_blank">search by swiftype</a>
        </section>
    </div>

    <!-- LEFT SIDEBAR -->
    <div class="st-ui-container-left_sidebar st-position-container">
      <div class="st-ui-injected-search-controls">
      </div>
    </div>

    <!-- RIGHT SIDEBAR -->
    <div class="st-ui-container-right_sidebar st-position-container">
      <div class="st-ui-injected-container-right_sidebar">
        <div class="st-ui-injected-search-controls">
        </div>
      </div>
    </div>

    <!-- PRIMARY CONTENT -->
    <div class="st-ui-container-primary_content st-position-container">
        <section style="display: none;" class="st-ui-slide-autocomplete st-autocomplete-keyboard-navigable st-autocomplete-transient-on-select-and-results" data-st-target-element="#st-overlay-search-input" data-st-active-query-class="active">
          <span class="st-ui-type-heading-small">suggested results</span>
          <div class="st-autocomplete-results"><div style="display: none;" class="st-query-present"></div></div>
        </section>

        <section class="st-ui-content st-search-results"><div class="st-query-not-present">
          <span class="st-ui-fallback"></span>
        </div><div style="display: none;" class="st-query-present"></div></section>

      <section class="st-ui-no-results st-search-suggestions"><div class="st-query-not-present">
      </div></section>
    </div>



    <!-- FOOTER -->
    <div class="st-ui-container-footer_bar st-position-container">
      <section class="st-ui-footer">
          <span class="st-ui-search-summary st-search-summary"></span>
        <span class="st-ui-pagination st-search-pagination"></span>
      </section>
    </div>
  </div>
</div>
<div class="st-default-autocomplete" data-st-target-element=".st-default-search-input" style="display: none; position: absolute; top: 49px; left: 0px; z-index: 999999;">
  <div class="st-autocomplete-results st-ui-autocomplete"><div style="display: none;" class="st-query-present"></div></div>
</div>
<a class="st-search-show-outputs st-ui-search-tab">Search this site</a></div></body><div class="" style="display: none; width: 24px; left: 984px; top: 1225px;" id="diigotb-imagepanel"><div class="diigotb-btn enabled" title="Save this image to Diigo" id="diigotb-quick-save"></div></div><div style="display: none; height: 662px; width: 1px; left: 182px; top: 595px;" class="diigotb-border diigotb-left"></div><div style="display: none; width: 836px; height: 1px; left: 182px; top: 595px;" class="diigotb-border diigotb-top"></div><div style="display: none; height: 662px; width: 1px; left: 1018px; top: 595px;" class="diigotb-border diigotb-right"></div><div style="display: none; width: 836px; height: 1px; left: 182px; top: 1257px;" class="diigotb-border diigotb-bottom"></div>
</html>
